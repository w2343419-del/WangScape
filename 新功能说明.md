# WSwriter 新增功能说明

## 🎉 功能更新 (2026-02-02)

### 1. 📌 文章置顶功能

#### 功能说明
- 可将重要文章置顶显示在文章列表最前面
- 置顶文章会显示红色"📌 置顶"标识
- 置顶文章优先于普通文章，按日期排序

#### 使用方法
1. 在编辑器中打开文章
2. 点击"元数据"按钮打开元数据面板
3. 勾选"📌 置顶文章"复选框
4. 点击"💾 应用更改"
5. 点击"保存"按钮保存文章
6. 返回仪表盘，置顶文章会显示在列表最前面

#### Frontmatter 配置
```yaml
---
title: "重要文章"
date: 2026-02-02T10:00:00+08:00
pinned: true  # 设置为 true 表示置顶
---
```

---

### 2. 🔍 留言者身份记录功能

#### 功能说明
为了应对突发事件，系统会自动记录每位留言者的以下信息：
- **IP 地址**：访客的网络地址
- **User-Agent**：访客的浏览器和操作系统信息

#### 特点
- **自动记录**：无需手动操作，提交评论时自动记录
- **隐私保护**：这些信息仅管理员可见，不会在前端展示
- **安全应对**：遇到恶意评论或突发事件时，可追溯来源

#### 查看方式
1. 在编辑器中打开有评论的文章
2. 点击"评论管理"按钮
3. 在评论列表中可以看到每条评论的：
   - **IP**: 留言者的IP地址
   - **UA**: 留言者的浏览器信息

#### 示例显示
```
强哥
· 2026-02-02 10:30:00

这是一条评论内容

IP: 192.168.1.100
UA: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36
```

#### 注意事项
- IP地址可能因代理/VPN而不准确
- MAC地址无法从服务器端获取（需要在同一局域网且有特殊权限）
- 建议配合网站访问日志进行综合分析

---

### 3. ✅ 评论审核机制（已确认）

#### 功能说明
所有访客提交的评论都需要经过审核才能在网站上显示，确保内容质量和安全性。

#### 工作流程
1. **访客提交评论** 
   - 在文章页面填写姓名、邮箱、评论内容
   - 点击"提交评论"
   - 系统提示"评论已提交，等待审核"

2. **管理员收到通知**
   - 打开 WSwriter
   - 左侧仪表盘显示"⏳ 待审核"数量（橙色）
   - 文章列表显示有待审评论的文章标记

3. **管理员审核**
   - 打开对应文章
   - 点击"评论管理"按钮
   - 待审核评论显示为黄色背景，标记"待审核"
   - 点击"批准"通过，或点击"删除"拒绝

4. **网站显示**
   - 仅已批准的评论在网站上显示
   - 未审核或被删除的评论不会公开

#### 状态说明
- 🟡 **待审核**：新提交的评论，黄色背景
- 🟢 **已批准**：通过审核，灰色背景，在网站上可见
- 🔴 **已删除**：恶意评论，从系统中移除

---

## 📋 功能总结

| 功能 | 状态 | 说明 |
|------|------|------|
| 文章置顶 | ✅ 已实现 | 可将重要文章固定在列表顶部 |
| IP地址记录 | ✅ 已实现 | 自动记录留言者IP地址 |
| User-Agent记录 | ✅ 已实现 | 自动记录浏览器和系统信息 |
| MAC地址记录 | ❌ 不支持 | 服务器端无法获取客户端MAC地址 |
| 评论审核机制 | ✅ 已实现 | 评论必须审核后才能公开显示 |

---

## 🚀 开始使用

1. **启动 WSwriter**
   ```bash
   .\WSwriter.exe
   ```

2. **访问管理界面**
   - 浏览器打开 http://localhost:8080
   - 查看仪表盘，可看到待审核评论数量
   - 点击文章查看详细的留言者信息

3. **测试置顶功能**
   - 选择一篇重要文章
   - 打开元数据面板
   - 勾选"置顶文章"
   - 保存并查看列表排序

---

## ⚠️ 重要说明

### 关于 MAC 地址
由于技术限制，服务器端无法直接获取客户端的 MAC 地址，原因如下：
- MAC 地址只在局域网内有效，不会通过互联网传输
- 浏览器出于安全考虑，不会暴露 MAC 地址给网页
- 即使使用 JavaScript，也无法获取真实 MAC 地址

**替代方案**：
- 系统记录的 **IP 地址** 和 **User-Agent** 已足够用于身份追溯
- 可以在网站服务器日志中查看更详细的访问记录
- 如需更严格的身份验证，建议配置登录系统

### 隐私与合规
- 记录访客信息需遵守当地隐私法规
- 建议在网站隐私政策中说明会记录IP地址
- 仅在必要时（如处理恶意行为）使用这些信息

---

## 📝 数据存储格式

评论数据存储在 `content/{lang}/post/{文章slug}/comments.json`：

```json
{
  "comments": [
    {
      "id": "1738472400-0",
      "author": "张三",
      "email": "zhangsan@example.com",
      "content": "很棒的文章！",
      "timestamp": "2026-02-02 10:30:00",
      "approved": false,
      "post_path": "content/zh-cn/post/my-article/index.md",
      "ip_address": "192.168.1.100",
      "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"
    }
  ]
}
```

---

## 🎯 下一步建议

1. **邮件通知**：收到新评论时发送邮件提醒
2. **评论回复**：支持对评论进行回复（嵌套评论）
3. **黑名单功能**：自动过滤特定IP或关键词
4. **批量操作**：一次性批准或删除多条评论
5. **评论导出**：导出评论数据为CSV格式

---

**版本**: WSwriter v2.0  
**更新日期**: 2026-02-02  
**开发者**: GitHub Copilot ✨
