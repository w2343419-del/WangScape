<aside class="sidebar left-sidebar sticky">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="Toggle Menu">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        <figure class="site-avatar">
            {{ $avatar := resources.Get "img/avatar.png" }}
            {{ if $avatar }}
                {{ $avatarResized := $avatar.Resize "300x" }}
                <img src="{{ $avatarResized.RelPermalink }}" width="150" height="150" class="site-logo" alt="Avatar">
            {{ else }}
                <img src="/img/avatar.png" width="150" height="150" class="site-logo" alt="Avatar">
            {{ end }}
            {{ with $.Site.Params.sidebar.emoji }}
            <span class="emoji">{{ . }}</span>
            {{ end }}
        </figure>

        <div class="site-meta">
            <h1 class="site-name"><a href="{{ .Site.BaseURL | relLangURL }}">{{ .Site.Title }}</a></h1>
            <h2 class="site-description">{{ .Site.Params.sidebar.subtitle }}</h2>
        </div>
    </header>

    {{- with .Site.Menus.social -}}
    <ol class="menu-social">
        {{ range . }}
        <li>
            <a href='{{ .URL }}' {{ if eq (default true .Params.newTab) true }}target="_blank" {{ end }} {{ with .Name
                }}title="{{ . }}" {{ end }} rel="me">
                {{ $icon := default "link" .Params.Icon }}
                {{ with $icon }}
                {{ partial "helper/icon" . }}
                {{ end }}
            </a>
        </li>
        {{ end }}
    </ol>
    {{- end -}}

    <ol class="menu" id="main-menu">
        {{ $currentPage := . }}
        {{ range .Site.Menus.main }}
        {{ $active := or (eq $currentPage.RelPermalink .URL) (or ($currentPage.HasMenuCurrent "main" .)
        ($currentPage.IsMenuCurrent "main" .)) }}
        <li {{ if $active }} class='current' {{ end }}>
            <a href='{{ .URL }}' {{ if eq .Params.newTab true }}target="_blank" {{ end }}>
                {{ $icon := default .Pre .Params.Icon }}
                {{ if .Pre }}
                {{ warnf `Menu item [%s] is using [pre] field to set icon, please use [params.icon] instead. More
                information: https://stack.jimmycai.com/config/menu` .URL }}
                {{ end }}
                {{ with $icon }}
                {{ partial "helper/icon" . }}
                {{ end }}
                <span>{{- .Name -}}</span>
            </a>
        </li>
        {{ end }}
    </ol>

    <!-- 左侧栏底部控制按钮 -->
    <div class="sidebar-footer-controls">
        {{- $hasTranslation := false -}}
        {{- $currentLanguageCode := .Language.Lang -}}
        {{- range .Translations -}}
        {{- if ne .Language.Lang $currentLanguageCode -}}
        {{- $hasTranslation = true -}}
        <a href="{{ .Permalink }}" id="lang-switch" class="lang-switch-btn" title="切换至 {{ .Language.LanguageName }}">
            {{ partial "helper/icon" "language" }}
            <span>{{ .Language.LanguageName }}</span>
        </a>
        {{- end -}}
        {{- end -}}
        
        {{- if not $hasTranslation -}}
        <!-- 占位元素，保持容器高度 -->
        <div style="height: 45px; min-height: 45px; max-height: 45px; flex-shrink: 0;"></div>
        {{- end -}}

        {{ if (default false .Site.Params.colorScheme.toggle) }}
        <div id="dark-mode-toggle">
            {{ partial "helper/icon" "toggle-left" }}
            {{ partial "helper/icon" "toggle-right" }}
            <span>{{ T "darkMode" }}</span>
        </div>
        {{ end }}
    </div>
</aside>

<!-- 头像弹出层 -->
<div id="avatar-modal" class="avatar-modal">
    <div class="avatar-modal-overlay"></div>
    <div class="avatar-modal-content">
        <img src="" alt="Avatar" class="avatar-modal-img">
    </div>
</div>

<script>
    (function () {
        const avatarLink = document.querySelector('.avatar-link');
        const modal = document.getElementById('avatar-modal');
        const modalImg = modal.querySelector('.avatar-modal-img');
        const overlay = modal.querySelector('.avatar-modal-overlay');

        if (avatarLink && modal) {
            avatarLink.addEventListener('click', function (e) {
                e.preventDefault();
                const avatarSrc = this.getAttribute('data-avatar');
                modalImg.src = avatarSrc;
                modal.classList.add('active');
                document.body.style.overflow = 'hidden';
            });

            function closeModal() {
                modal.classList.remove('active');
                document.body.style.overflow = '';
            }

            overlay.addEventListener('click', closeModal);
            modal.querySelector('.avatar-modal-content').addEventListener('click', closeModal);

            document.addEventListener('keydown', function (e) {
                if (e.key === 'Escape' && modal.classList.contains('active')) {
                    closeModal();
                }
            });
        }
    })();
</script>