<!-- Umami 统计脚本 -->
<script async src="https://unknown-qzthzzic4-w2343419-dels-projects.vercel.app/script.js" 
        data-website-id="aee9b0a3-00c8-4037-8b99-e6bb4c336cb9"></script>

<!-- 阅读量显示和统计 -->
<script>
    // 获取或更新页面阅读量
    function getPageViews(path) {
        const storageKey = 'page_views_' + path.replace(/\//g, '_');
        return parseInt(localStorage.getItem(storageKey) || '0');
    }
    
    function incrementPageViews(path) {
        const storageKey = 'page_views_' + path.replace(/\//g, '_');
        let views = getPageViews(path);
        views++;
        localStorage.setItem(storageKey, views.toString());
        return views;
    }
    
    document.addEventListener('DOMContentLoaded', function () {
        const currentPath = window.location.pathname;
        
        // 处理文章详情页的阅读量
        const detailViewsElement = document.querySelector('[data-umami-page-pv] .umami-value');
        if (detailViewsElement && currentPath.includes('/p/')) {
            // 文章详情页：增加阅读量
            const views = incrementPageViews(currentPath);
            detailViewsElement.innerText = views;
        }
        
        // 处理首页和列表页的阅读量显示
        setTimeout(function() {
            document.querySelectorAll('[data-umami-page-pv] .umami-value').forEach(function (viewsElement) {
                // 跳过已经处理过的详情页元素
                if (viewsElement.innerText !== '0') return;
                
                // 找到最近的 article 元素
                const article = viewsElement.closest('article');
                if (!article) return;
                
                // 找到文章链接
                const link = article.querySelector('a[href*="/p/"]');
                if (!link) return;
                
                // 获取文章路径
                const articlePath = new URL(link.href, window.location.origin).pathname;
                
                // 显示该文章的阅读量
                const views = getPageViews(articlePath);
                viewsElement.innerText = views;
            });
        }, 100);
    });
</script>

<!-- 点击文章卡片进入阅读 -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        document.querySelectorAll('.article-list article').forEach(function (article) {
            article.addEventListener('click', function (e) {
                // 如果点击的是链接，不处理
                if (e.target.tagName === 'A' || e.target.closest('a')) {
                    return;
                }
                // 找到文章标题链接并跳转
                const link = article.querySelector('.article-title a');
                if (link) {
                    window.location.href = link.href;
                }
            });
        });
    });
</script>

<!-- 滚动指示器 -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const mainContainer = document.querySelector('.main');
        if (!mainContainer) return;

        // 创建滚动指示器
        const indicator = document.createElement('div');
        indicator.className = 'scroll-indicator';
        indicator.innerHTML = `
            <div class="indicator-text">滚动</div>
            <div class="indicator-arrow"></div>
        `;
        document.body.appendChild(indicator);

        // 检测是否可以滚动以及是否到达底部
        function checkScroll() {
            const scrollTop = mainContainer.scrollTop;
            const scrollHeight = mainContainer.scrollHeight;
            const clientHeight = mainContainer.clientHeight;
            const scrollableHeight = scrollHeight - clientHeight;
            
            // 如果可以滚动且未到达底部90%，显示指示器
            if (scrollableHeight > 100 && scrollTop < scrollableHeight * 0.9) {
                indicator.classList.add('show');
            } else {
                indicator.classList.remove('show');
            }
        }

        // 初始检测
        setTimeout(checkScroll, 500);

        // 监听滚动事件
        mainContainer.addEventListener('scroll', checkScroll);

        // 监听窗口大小变化
        window.addEventListener('resize', checkScroll);
    });
</script>

<!-- 分页增强功能 -->
<script src="{{ "js/pagination-enhanced.js" | relURL }}"></script>

<!-- 超级简单换页系统 -->
<script src="{{ "js/ultra-simple-paginator.js" | relURL }}"></script>