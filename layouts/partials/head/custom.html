<!-- 简单初始化脚本，无需冻结 -->
<script>
    // 页面加载完成后的初始化逻辑
    window.addEventListener('load', () => {
        // 页面完全加载
    });
</script>

<!-- Umami 统计 -->
<script defer src="https://unknown-qzthzzic4-w2343419-dels-projects.vercel.app/script.js"
    data-website-id="aee9b0a3-00c8-4037-8b99-e6bb4c336cb9"></script>

<!-- Umami 阅读量显示 -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const umamiInstance = "https://unknown-qzthzzic4-w2343419-dels-projects.vercel.app";
        const websiteId = "aee9b0a3-00c8-4037-8b99-e6bb4c336cb9";
        const viewsElement = document.querySelector('[data-umami-page-pv] .umami-value');

        if (viewsElement) {
            // 使用 Umami 的公共 API 获取当前页面的 PV
            // 注意：这取决于 Umami 是否允许公共访问统计数据，
            // 或者是否配置了公开共享链接。
            const currentPath = window.location.pathname;
            const startAt = new Date(2020, 0, 1).getTime(); // 从很早以前开始统计
            const endAt = Date.now();

            const apiUrl = `${umamiInstance}/api/websites/${websiteId}/stats?startAt=${startAt}&endAt=${endAt}&url=${encodeURIComponent(currentPath)}`;

            // 尝试从 localStorage 缓存中读取或直接发送请求
            // 由于 Umami API 权限限制，这里通常需要公开共享令牌
            // 如果没有公开令牌，这里可能返回 0 或 401
            fetch(apiUrl)
                .then(res => res.json())
                .then(data => {
                    if (data && data.pageviews) {
                        viewsElement.innerText = data.pageviews.value;
                    }
                })
                .catch(err => console.error('Umami views fetch error:', err));
        }
    });
</script>

<!-- 点击文章卡片进入阅读 -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        document.querySelectorAll('.article-list article').forEach(function (article) {
            article.addEventListener('click', function (e) {
                // 如果点击的是链接，不处理
                if (e.target.tagName === 'A' || e.target.closest('a')) {
                    return;
                }
                // 找到文章标题链接并跳转
                const link = article.querySelector('.article-title a');
                if (link) {
                    window.location.href = link.href;
                }
            });
        });
    });
</script>

<!-- 滚动指示器 -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const mainContainer = document.querySelector('.main');
        if (!mainContainer) return;

        // 创建滚动指示器
        const indicator = document.createElement('div');
        indicator.className = 'scroll-indicator';
        indicator.innerHTML = `
            <div class="indicator-text">滚动</div>
            <div class="indicator-arrow"></div>
        `;
        document.body.appendChild(indicator);

        // 检测是否可以滚动以及是否到达底部
        function checkScroll() {
            const scrollTop = mainContainer.scrollTop;
            const scrollHeight = mainContainer.scrollHeight;
            const clientHeight = mainContainer.clientHeight;
            const scrollableHeight = scrollHeight - clientHeight;
            
            // 如果可以滚动且未到达底部90%，显示指示器
            if (scrollableHeight > 100 && scrollTop < scrollableHeight * 0.9) {
                indicator.classList.add('show');
            } else {
                indicator.classList.remove('show');
            }
        }

        // 初始检测
        setTimeout(checkScroll, 500);

        // 监听滚动事件
        mainContainer.addEventListener('scroll', checkScroll);

        // 监听窗口大小变化
        window.addEventListener('resize', checkScroll);
    });
</script>

<!-- 分页增强功能 -->
<script src="{{ "js/pagination-enhanced.js" | relURL }}"></script>

<!-- 超级简单换页系统 -->
<script src="{{ "js/ultra-simple-paginator.js" | relURL }}"></script>