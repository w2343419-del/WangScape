<!-- 简单初始化脚本，无需冻结 -->
<script>
    // 页面加载完成后的初始化逻辑
    window.addEventListener('load', () => {
        // 页面完全加载
    });
</script>

<!-- Umami 统计 -->
<script defer src="https://unknown-qzthzzic4-w2343419-dels-projects.vercel.app/script.js"
    data-website-id="aee9b0a3-00c8-4037-8b99-e6bb4c336cb9"></script>

<!-- 阅读量统计 (本地存储) -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const viewsElement = document.querySelector('[data-umami-page-pv] .umami-value');
        
        if (viewsElement) {
            const currentPath = window.location.pathname;
            const storageKey = 'page_views';
            
            // 获取所有页面的浏览记录
            let allViews = {};
            try {
                const stored = localStorage.getItem(storageKey);
                if (stored) {
                    allViews = JSON.parse(stored);
                }
            } catch (e) {
                console.error('读取浏览记录失败:', e);
            }
            
            // 如果当前页面没有记录，初始化为 0
            if (!allViews[currentPath]) {
                allViews[currentPath] = 0;
            }
            
            // 增加阅读量
            allViews[currentPath]++;
            
            // 保存到 localStorage
            try {
                localStorage.setItem(storageKey, JSON.stringify(allViews));
            } catch (e) {
                console.error('保存浏览记录失败:', e);
            }
            
            // 显示阅读量
            viewsElement.innerText = allViews[currentPath];
        }
    });
</script>

<!-- 点击文章卡片进入阅读 -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        document.querySelectorAll('.article-list article').forEach(function (article) {
            article.addEventListener('click', function (e) {
                // 如果点击的是链接，不处理
                if (e.target.tagName === 'A' || e.target.closest('a')) {
                    return;
                }
                // 找到文章标题链接并跳转
                const link = article.querySelector('.article-title a');
                if (link) {
                    window.location.href = link.href;
                }
            });
        });
    });
</script>

<!-- 滚动指示器 -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const mainContainer = document.querySelector('.main');
        if (!mainContainer) return;

        // 创建滚动指示器
        const indicator = document.createElement('div');
        indicator.className = 'scroll-indicator';
        indicator.innerHTML = `
            <div class="indicator-text">滚动</div>
            <div class="indicator-arrow"></div>
        `;
        document.body.appendChild(indicator);

        // 检测是否可以滚动以及是否到达底部
        function checkScroll() {
            const scrollTop = mainContainer.scrollTop;
            const scrollHeight = mainContainer.scrollHeight;
            const clientHeight = mainContainer.clientHeight;
            const scrollableHeight = scrollHeight - clientHeight;
            
            // 如果可以滚动且未到达底部90%，显示指示器
            if (scrollableHeight > 100 && scrollTop < scrollableHeight * 0.9) {
                indicator.classList.add('show');
            } else {
                indicator.classList.remove('show');
            }
        }

        // 初始检测
        setTimeout(checkScroll, 500);

        // 监听滚动事件
        mainContainer.addEventListener('scroll', checkScroll);

        // 监听窗口大小变化
        window.addEventListener('resize', checkScroll);
    });
</script>

<!-- 分页增强功能 -->
<script src="{{ "js/pagination-enhanced.js" | relURL }}"></script>

<!-- 超级简单换页系统 -->
<script src="{{ "js/ultra-simple-paginator.js" | relURL }}"></script>