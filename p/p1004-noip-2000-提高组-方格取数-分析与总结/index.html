<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="经典棋盘模型问题的多种解法分析：动态规划、DFS 记忆化和费用流"><title>P1004 [NOIP 2000 提高组] 方格取数 分析与总结</title><link rel=canonical href=https://w2343419-del.github.io/WangScape/p/p1004-noip-2000-%E6%8F%90%E9%AB%98%E7%BB%84-%E6%96%B9%E6%A0%BC%E5%8F%96%E6%95%B0-%E5%88%86%E6%9E%90%E4%B8%8E%E6%80%BB%E7%BB%93/><link rel=stylesheet href=/WangScape/scss/style.min.6059284a08e53c8e4251c184daa78a3d1444603df1ba77b060ea15a51a336941.css><meta property='og:title' content="P1004 [NOIP 2000 提高组] 方格取数 分析与总结"><meta property='og:description' content="经典棋盘模型问题的多种解法分析：动态规划、DFS 记忆化和费用流"><meta property='og:url' content='https://w2343419-del.github.io/WangScape/p/p1004-noip-2000-%E6%8F%90%E9%AB%98%E7%BB%84-%E6%96%B9%E6%A0%BC%E5%8F%96%E6%95%B0-%E5%88%86%E6%9E%90%E4%B8%8E%E6%80%BB%E7%BB%93/'><meta property='og:site_name' content='望境'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='算法'><meta property='article:published_time' content='2026-02-28T11:31:00+08:00'><meta property='article:modified_time' content='2026-02-28T11:31:00+08:00'><meta name=twitter:title content="P1004 [NOIP 2000 提高组] 方格取数 分析与总结"><meta name=twitter:description content="经典棋盘模型问题的多种解法分析：动态规划、DFS 记忆化和费用流"><link rel="shortcut icon" href=/WangScape/favicon.png><script async src=https://unknown-qzthzzic4-w2343419-dels-projects.vercel.app/script.js data-website-id=aee9b0a3-00c8-4037-8b99-e6bb4c336cb9></script><script>function getPageViews(e){const t="page_views_"+e.replace(/\//g,"_");return parseInt(localStorage.getItem(t)||"0")}function incrementPageViews(e){const n="page_views_"+e.replace(/\//g,"_");let t=getPageViews(e);return t++,localStorage.setItem(n,t.toString()),t}document.addEventListener("DOMContentLoaded",function(){const e=window.location.pathname,t=document.querySelector("[data-umami-page-pv] .umami-value");if(t&&e.includes("/p/")){const n=incrementPageViews(e);t.innerText=n}setTimeout(function(){document.querySelectorAll("[data-umami-page-pv] .umami-value").forEach(function(e){if(e.innerText!=="0")return;const t=e.closest("article");if(!t)return;const n=t.querySelector('a[href*="/p/"]');if(!n)return;const s=new URL(n.href,window.location.origin).pathname,o=getPageViews(s);e.innerText=o})},100)})</script><script>document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll(".article-list article").forEach(function(e){e.addEventListener("click",function(t){if(t.target.tagName==="A"||t.target.closest("a"))return;const n=e.querySelector(".article-title a");n&&(window.location.href=n.href)})})})</script><script>document.addEventListener("DOMContentLoaded",function(){const e=document.querySelector(".main");if(!e)return;const t=document.createElement("div");t.className="scroll-indicator",t.innerHTML=`
            <div class="indicator-text">滚动</div>
            <div class="indicator-arrow"></div>
        `,document.body.appendChild(t);function n(){const s=e.scrollTop,o=e.scrollHeight,i=e.clientHeight,n=o-i;n>100&&s<n*.9?t.classList.add("show"):t.classList.remove("show")}setTimeout(n,500),e.addEventListener("scroll",n),window.addEventListener("resize",n)})</script><script src=/WangScape/js/pagination-enhanced.js></script><script src=/WangScape/js/ultra-simple-paginator.js></script></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><img src=/WangScape/img/avatar_hu_499b94489a20731a.png width=150 height=150 class=site-logo alt=Avatar></figure><div class=site-meta><h1 class=site-name><a href=/WangScape>望境</a></h1><h2 class=site-description>偏我去时花满楼，偏我来时不逢春。</h2></div></header><ol class=menu id=main-menu><li><a href=/WangScape/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>首页</span></a></li><li><a href=/WangScape/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>归档</span></a></li><li><a href=/WangScape/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>搜索</span></a></li><li><a href=/WangScape/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>友情链接</span></a></li></ol><div class=sidebar-footer-controls><a href=https://w2343419-del.github.io/WangScape/en/p/p1004-noip-2000-improvement-group-grid-score-analysis-and-summary/ id=lang-switch class=lang-switch-btn title="切换至 English"><svg class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg>
<span>English</span></a><div id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>暗色模式</span></div></div></aside><div id=avatar-modal class=avatar-modal><div class=avatar-modal-overlay></div><div class=avatar-modal-content><img src alt=Avatar class=avatar-modal-img></div></div><script>(function(){const n=document.querySelector(".avatar-link"),e=document.getElementById("avatar-modal"),s=e.querySelector(".avatar-modal-img"),o=e.querySelector(".avatar-modal-overlay");if(n&&e){n.addEventListener("click",function(t){t.preventDefault();const n=this.getAttribute("data-avatar");s.src=n,e.classList.add("active"),document.body.style.overflow="hidden"});function t(){e.classList.remove("active"),document.body.style.overflow=""}o.addEventListener("click",t),e.querySelector(".avatar-modal-content").addEventListener("click",t),document.addEventListener("keydown",function(n){n.key==="Escape"&&e.classList.contains("active")&&t()})}})()</script><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/WangScape/categories/%E7%AE%97%E6%B3%95/>算法</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/WangScape/p/p1004-noip-2000-%E6%8F%90%E9%AB%98%E7%BB%84-%E6%96%B9%E6%A0%BC%E5%8F%96%E6%95%B0-%E5%88%86%E6%9E%90%E4%B8%8E%E6%80%BB%E7%BB%93/>P1004 [NOIP 2000 提高组] 方格取数 分析与总结</a></h2><h3 class=article-subtitle>经典棋盘模型问题的多种解法分析：动态规划、DFS 记忆化和费用流</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published datetime=2026-02-28T11:31:00+08:00>Feb 28, 2026</time></div><div class=article-views><svg class="icon icon-tabler icon-tabler-eye" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M10 12a2 2 0 104 0 2 2 0 00-4 0"/><path d="M21 12c-2.4 4-5.4 6-9 6s-6.6-2-9-6c2.4-4 5.4-6 9-6s6.6 2 9 6"/></svg>
<span class=umami-views data-umami-page-pv><span class=umami-value>0</span> 次阅读</span></div></footer><footer class=article-translations><svg class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg><div><a href=https://w2343419-del.github.io/WangScape/en/p/p1004-noip-2000-improvement-group-grid-score-analysis-and-summary/ class=link>English</a></div></footer></div></header><section class=article-content><p>这是一道经典但具有一定难度的棋盘模型题。虽然是 2000 年的 NOIP 题目，但作为压轴题，对于第一次接触的人来说还是相当困难的。本文总结了三种不同的解法：动态规划、DFS 记忆化和最小费用最大流，从易到难逐步展开。</p><h2 id=题目背景与描述>题目背景与描述</h2><p>NOIP 2000 提高组 T4</p><p>题目描述</p><p>设有 N×N 的方格图 (N≤9)，我们将其中的某些方格中填入正整数，而其他的方格中则放入数字 0。
某人从图的左上角的 A 点（0，0）出发，可以向下行走，也可以向右走，直到到达右下角的 B 点（N, N)。在走过的路上，他可以取走方格中的数（取走后的方格中将变为数字 0）。
此人从 A 点到 B 点共走两次，试找出 2 条这样的路径，使得取得的数之和为最大。</p><p>输入格式</p><p>输入的第一行为一个整数 N（表示 N×N 的方格图），接下来的每行有三个整数，前两个表示位置，第三个数为该位置上所放的数。一行单独的 0 表示输入结束。</p><p>输出格式</p><p>只需输出一个整数，表示 2 条路径上取得的最大的和。</p><p>输入输出样例</p><p>输入</p><p>8</p><p>2 3 13</p><p>2 6 6</p><p>3 5 7</p><p>4 4 14</p><p>5 2 21</p><p>5 6 4</p><p>6 3 15</p><p>7 2 14</p><p>0 0 0</p><p>输出
67</p><p>说明/提示</p><p>数据范围：1≤N≤9。</p><p>我一开始尝试是选择的先进行一轮枚举，然后再对已进行了更改的 matrix 进行再一次的枚举（就是模拟取数），但是发现难度有点过大。最后实在想不出来解决方法了，找了 Claude，它给出的解决方法是采用 dp 算法（详见解法一），我又想到了 DFS 结合剪枝的算法（感谢自己之前做的走迷宫问题，那是一道有关最少步数的算法题，刚好适用于 DFS 结合剪枝）（详见解法二），随后 Claude 还给出了一个适用于一般解的算法————费用流解法（难度过大，属于超纲解法，略写一二，详见解法三）。</p><p>ps. 解释一下为什么不能采取两次枚举。一次路径会改变地图，影响第二次，所以两条路径必须联动考虑。</p><h3 id=解法一dp-动态规划>解法一（dp 动态规划）：</h3><p>核心思想：将两条路径同步推进，用一个DP同时模拟两个人的行走。</p><p>状态设计：设 dp[k][x1][x2]，其中：</p><p>k 为当前走的步数（即 x + y 的值，从2到2N）</p><p>x1、x2 分别为两人当前所在的行号</p><p>由 k 和 x 可以推出 y = k - x（关键，这一步降低了维度），因此列号不需要单独存储</p><p>去重处理：当两人在同一格时（x1 == x2，则 y1 == y2），该格只取一次。</p><p>转移：每步两人各自可以选择向右或向下，共4种组合。</p><p>完整代码</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>N</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>map</span><span class=p>[</span><span class=mi>10</span><span class=p>][</span><span class=mi>10</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>dp</span><span class=p>[</span><span class=mi>20</span><span class=p>][</span><span class=mi>10</span><span class=p>][</span><span class=mi>10</span><span class=p>];</span> <span class=c1>// dp[步数][人1的行][人2的行]
</span></span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>N</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>,</span> <span class=n>v</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=p>(</span><span class=nf>scanf</span><span class=p>(</span><span class=s>&#34;%d %d %d&#34;</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>x</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>y</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>v</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=p>(</span><span class=n>x</span> <span class=o>||</span> <span class=n>y</span> <span class=o>||</span> <span class=n>v</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=n>map</span><span class=p>[</span><span class=n>x</span><span class=p>][</span><span class=n>y</span><span class=p>]</span> <span class=o>=</span> <span class=n>v</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 初始化为-1表示不可达
</span></span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>k</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>k</span> <span class=o>&lt;</span> <span class=mi>20</span><span class=p>;</span> <span class=n>k</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mi>10</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>j</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>j</span> <span class=o>&lt;</span> <span class=mi>10</span><span class=p>;</span> <span class=n>j</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>dp</span><span class=p>[</span><span class=n>k</span><span class=p>][</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>dp</span><span class=p>[</span><span class=mi>2</span><span class=p>][</span><span class=mi>1</span><span class=p>][</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=n>map</span><span class=p>[</span><span class=mi>1</span><span class=p>][</span><span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// ========== 动态规划主循环 ==========
</span></span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>k</span> <span class=o>=</span> <span class=mi>2</span><span class=p>;</span> <span class=n>k</span> <span class=o>&lt;</span> <span class=mi>2</span> <span class=o>*</span> <span class=n>N</span><span class=p>;</span> <span class=n>k</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>x1</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span> <span class=n>x1</span> <span class=o>&lt;=</span> <span class=n>N</span><span class=p>;</span> <span class=n>x1</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kt>int</span> <span class=n>y1</span> <span class=o>=</span> <span class=n>k</span> <span class=o>-</span> <span class=n>x1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>y1</span> <span class=o>&lt;</span> <span class=mi>1</span> <span class=o>||</span> <span class=n>y1</span> <span class=o>&gt;</span> <span class=n>N</span><span class=p>)</span> <span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>x2</span> <span class=o>=</span> <span class=n>x1</span><span class=p>;</span> <span class=n>x2</span> <span class=o>&lt;=</span> <span class=n>N</span><span class=p>;</span> <span class=n>x2</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=kt>int</span> <span class=n>y2</span> <span class=o>=</span> <span class=n>k</span> <span class=o>-</span> <span class=n>x2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=n>y2</span> <span class=o>&lt;</span> <span class=mi>1</span> <span class=o>||</span> <span class=n>y2</span> <span class=o>&gt;</span> <span class=n>N</span><span class=p>)</span> <span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=n>dp</span><span class=p>[</span><span class=n>k</span><span class=p>][</span><span class=n>x1</span><span class=p>][</span><span class=n>x2</span><span class=p>]</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>)</span> <span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=c1>// 尝试所有4种移动组合
</span></span></span><span class=line><span class=cl>                <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>m1</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>m1</span> <span class=o>&lt;=</span> <span class=mi>1</span><span class=p>;</span> <span class=n>m1</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>m2</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>m2</span> <span class=o>&lt;=</span> <span class=mi>1</span><span class=p>;</span> <span class=n>m2</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=kt>int</span> <span class=n>nx1</span> <span class=o>=</span> <span class=n>x1</span> <span class=o>+</span> <span class=n>m1</span><span class=p>,</span>     <span class=n>ny1</span> <span class=o>=</span> <span class=n>y1</span> <span class=o>+</span> <span class=p>(</span><span class=mi>1</span> <span class=o>-</span> <span class=n>m1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                        <span class=kt>int</span> <span class=n>nx2</span> <span class=o>=</span> <span class=n>x2</span> <span class=o>+</span> <span class=n>m2</span><span class=p>,</span>     <span class=n>ny2</span> <span class=o>=</span> <span class=n>y2</span> <span class=o>+</span> <span class=p>(</span><span class=mi>1</span> <span class=o>-</span> <span class=n>m2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                        <span class=k>if</span> <span class=p>(</span><span class=n>nx1</span> <span class=o>&gt;</span> <span class=n>N</span> <span class=o>||</span> <span class=n>ny1</span> <span class=o>&gt;</span> <span class=n>N</span><span class=p>)</span> <span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                        <span class=k>if</span> <span class=p>(</span><span class=n>nx2</span> <span class=o>&gt;</span> <span class=n>N</span> <span class=o>||</span> <span class=n>ny2</span> <span class=o>&gt;</span> <span class=n>N</span><span class=p>)</span> <span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                        <span class=c1>// 计算当前步收益
</span></span></span><span class=line><span class=cl>                        <span class=kt>int</span> <span class=n>gain</span> <span class=o>=</span> <span class=n>map</span><span class=p>[</span><span class=n>nx1</span><span class=p>][</span><span class=n>ny1</span><span class=p>];</span>
</span></span><span class=line><span class=cl>                        <span class=k>if</span> <span class=p>(</span><span class=n>nx1</span> <span class=o>!=</span> <span class=n>nx2</span><span class=p>)</span> <span class=n>gain</span> <span class=o>+=</span> <span class=n>map</span><span class=p>[</span><span class=n>nx2</span><span class=p>][</span><span class=n>ny2</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                        <span class=c1>// 规范化：保证 a &lt;= b
</span></span></span><span class=line><span class=cl>                        <span class=kt>int</span> <span class=n>a</span> <span class=o>=</span> <span class=n>nx1</span><span class=p>,</span> <span class=n>b</span> <span class=o>=</span> <span class=n>nx2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                        <span class=k>if</span> <span class=p>(</span><span class=n>a</span> <span class=o>&gt;</span> <span class=n>b</span><span class=p>)</span> <span class=p>{</span> <span class=kt>int</span> <span class=n>t</span> <span class=o>=</span> <span class=n>a</span><span class=p>;</span> <span class=n>a</span> <span class=o>=</span> <span class=n>b</span><span class=p>;</span> <span class=n>b</span> <span class=o>=</span> <span class=n>t</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                        <span class=kt>int</span> <span class=n>newval</span> <span class=o>=</span> <span class=n>dp</span><span class=p>[</span><span class=n>k</span><span class=p>][</span><span class=n>x1</span><span class=p>][</span><span class=n>x2</span><span class=p>]</span> <span class=o>+</span> <span class=n>gain</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                        <span class=k>if</span> <span class=p>(</span><span class=n>newval</span> <span class=o>&gt;</span> <span class=n>dp</span><span class=p>[</span><span class=n>k</span> <span class=o>+</span> <span class=mi>1</span><span class=p>][</span><span class=n>a</span><span class=p>][</span><span class=n>b</span><span class=p>])</span>
</span></span><span class=line><span class=cl>                            <span class=n>dp</span><span class=p>[</span><span class=n>k</span> <span class=o>+</span> <span class=mi>1</span><span class=p>][</span><span class=n>a</span><span class=p>][</span><span class=n>b</span><span class=p>]</span> <span class=o>=</span> <span class=n>newval</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>dp</span><span class=p>[</span><span class=mi>2</span> <span class=o>*</span> <span class=n>N</span><span class=p>][</span><span class=n>N</span><span class=p>][</span><span class=n>N</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>时间复杂度：O(N³)</p><h3 id=解法二dfs--剪枝>解法二（DFS + 剪枝）：</h3><p>核心思想：类似于 dp 算法（毕竟深搜和 dp 本质上就是一个东西），但添加了记忆化搜索这一步，避免了重复搜索。（若无记忆化搜索，计算量将是指数级爆炸，在 N=9 时约为 4^16 次）</p><p>完整代码</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// ========== DFS + 记忆化搜索 ==========
</span></span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>N</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>map</span><span class=p>[</span><span class=mi>10</span><span class=p>][</span><span class=mi>10</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>memo</span><span class=p>[</span><span class=mi>20</span><span class=p>][</span><span class=mi>10</span><span class=p>][</span><span class=mi>10</span><span class=p>];</span>    <span class=c1>// 记忆化数组
</span></span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>visited</span><span class=p>[</span><span class=mi>20</span><span class=p>][</span><span class=mi>10</span><span class=p>][</span><span class=mi>10</span><span class=p>];</span> <span class=c1>// 标记是否计算过
</span></span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>dfs</span><span class=p>(</span><span class=kt>int</span> <span class=n>k</span><span class=p>,</span> <span class=kt>int</span> <span class=n>x1</span><span class=p>,</span> <span class=kt>int</span> <span class=n>x2</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>x1</span> <span class=o>==</span> <span class=n>N</span> <span class=o>&amp;&amp;</span> <span class=n>x2</span> <span class=o>==</span> <span class=n>N</span><span class=p>)</span> <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>visited</span><span class=p>[</span><span class=n>k</span><span class=p>][</span><span class=n>x1</span><span class=p>][</span><span class=n>x2</span><span class=p>])</span> <span class=k>return</span> <span class=n>memo</span><span class=p>[</span><span class=n>k</span><span class=p>][</span><span class=n>x1</span><span class=p>][</span><span class=n>x2</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=n>visited</span><span class=p>[</span><span class=n>k</span><span class=p>][</span><span class=n>x1</span><span class=p>][</span><span class=n>x2</span><span class=p>]</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>y1</span> <span class=o>=</span> <span class=n>k</span> <span class=o>-</span> <span class=n>x1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>y2</span> <span class=o>=</span> <span class=n>k</span> <span class=o>-</span> <span class=n>x2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>best</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>m1</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>m1</span> <span class=o>&lt;=</span> <span class=mi>1</span><span class=p>;</span> <span class=n>m1</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>m2</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>m2</span> <span class=o>&lt;=</span> <span class=mi>1</span><span class=p>;</span> <span class=n>m2</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kt>int</span> <span class=n>nx1</span> <span class=o>=</span> <span class=n>x1</span> <span class=o>+</span> <span class=n>m1</span><span class=p>,</span>  <span class=n>ny1</span> <span class=o>=</span> <span class=n>y1</span> <span class=o>+</span> <span class=p>(</span><span class=mi>1</span> <span class=o>-</span> <span class=n>m1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=kt>int</span> <span class=n>nx2</span> <span class=o>=</span> <span class=n>x2</span> <span class=o>+</span> <span class=n>m2</span><span class=p>,</span>  <span class=n>ny2</span> <span class=o>=</span> <span class=n>y2</span> <span class=o>+</span> <span class=p>(</span><span class=mi>1</span> <span class=o>-</span> <span class=n>m2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>nx1</span> <span class=o>&gt;</span> <span class=n>N</span> <span class=o>||</span> <span class=n>ny1</span> <span class=o>&gt;</span> <span class=n>N</span><span class=p>)</span> <span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>nx2</span> <span class=o>&gt;</span> <span class=n>N</span> <span class=o>||</span> <span class=n>ny2</span> <span class=o>&gt;</span> <span class=n>N</span><span class=p>)</span> <span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=kt>int</span> <span class=n>a</span> <span class=o>=</span> <span class=n>nx1</span><span class=p>,</span> <span class=n>b</span> <span class=o>=</span> <span class=n>nx2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>a</span> <span class=o>&gt;</span> <span class=n>b</span><span class=p>)</span> <span class=p>{</span> <span class=kt>int</span> <span class=n>t</span> <span class=o>=</span> <span class=n>a</span><span class=p>;</span> <span class=n>a</span> <span class=o>=</span> <span class=n>b</span><span class=p>;</span> <span class=n>b</span> <span class=o>=</span> <span class=n>t</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=kt>int</span> <span class=n>sub</span> <span class=o>=</span> <span class=nf>dfs</span><span class=p>(</span><span class=n>k</span> <span class=o>+</span> <span class=mi>1</span><span class=p>,</span> <span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>sub</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>)</span> <span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=kt>int</span> <span class=n>gain</span> <span class=o>=</span> <span class=n>map</span><span class=p>[</span><span class=n>nx1</span><span class=p>][</span><span class=n>ny1</span><span class=p>];</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>nx1</span> <span class=o>!=</span> <span class=n>nx2</span><span class=p>)</span> <span class=n>gain</span> <span class=o>+=</span> <span class=n>map</span><span class=p>[</span><span class=n>nx2</span><span class=p>][</span><span class=n>ny2</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>gain</span> <span class=o>+</span> <span class=n>sub</span> <span class=o>&gt;</span> <span class=n>best</span><span class=p>)</span> <span class=n>best</span> <span class=o>=</span> <span class=n>gain</span> <span class=o>+</span> <span class=n>sub</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>memo</span><span class=p>[</span><span class=n>k</span><span class=p>][</span><span class=n>x1</span><span class=p>][</span><span class=n>x2</span><span class=p>]</span> <span class=o>=</span> <span class=n>best</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>best</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>N</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>,</span> <span class=n>v</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=p>(</span><span class=nf>scanf</span><span class=p>(</span><span class=s>&#34;%d %d %d&#34;</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>x</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>y</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>v</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=p>(</span><span class=n>x</span> <span class=o>||</span> <span class=n>y</span> <span class=o>||</span> <span class=n>v</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=n>map</span><span class=p>[</span><span class=n>x</span><span class=p>][</span><span class=n>y</span><span class=p>]</span> <span class=o>=</span> <span class=n>v</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nf>memset</span><span class=p>(</span><span class=n>visited</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=k>sizeof</span><span class=p>(</span><span class=n>visited</span><span class=p>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>start_val</span> <span class=o>=</span> <span class=n>map</span><span class=p>[</span><span class=mi>1</span><span class=p>][</span><span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>result</span> <span class=o>=</span> <span class=nf>dfs</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>result</span> <span class=o>&gt;=</span> <span class=mi>0</span> <span class=o>?</span> <span class=n>start_val</span> <span class=o>+</span> <span class=nl>result</span> <span class=p>:</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>时间复杂度：O(N³)</p><h3 id=解法三费用流解法>解法三（费用流解法）：</h3><p>核心思想：将"两条路径取最大值"转化为网络流问题。</p><p>建模思路
关键观察：
两条从 A 到 B 的路径 = 从源点到汇点流量为 2 的流
每个格子最多取一次 = 每个节点容量为 1
取得数字最大 = 费用最大（转为最小费用取负值）</p><p>拆点： 每个格子 (i,j) 拆成两个节点 in 和 out：
in → out：容量 1，费用 -map[i][j]（取负是因为求最小费用）
in → out：再加一条容量 1，费用 0（允许第二条路径经过但不重复取值）
即：合并为容量 2，但只有第一单位流有收益</p><p>连边： (i,j) 的 out 连向 (i+1,j) 的 in 和 (i,j+1) 的 in，容量 2，费用 0。</p><p>源汇： 源点 S 连 (1,1).in，(N,N).out 连汇点 T，流量均为 2。</p><p>每个格子(i,j)拆点后:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>容量1，费用-val   (第一条路经过，取走数字)
</span></span><span class=line><span class=cl>in(i,j) ================&gt; out(i,j)
</span></span><span class=line><span class=cl>容量1，费用0     (第二条路经过，数字已取走)
</span></span></code></pre></td></tr></table></div></div><p>完整代码（MCMF，SPFA实现）</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cp>#define MAXN 1000
</span></span></span><span class=line><span class=cl><span class=cp>#define MAXE 10000
</span></span></span><span class=line><span class=cl><span class=cp>#define INF  0x3f3f3f3f
</span></span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// ========== 链式前向星数据结构 ==========
</span></span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>head</span><span class=p>[</span><span class=n>MAXN</span><span class=p>],</span> <span class=n>nxt</span><span class=p>[</span><span class=n>MAXE</span><span class=p>],</span> <span class=n>to</span><span class=p>[</span><span class=n>MAXE</span><span class=p>],</span> <span class=n>cap</span><span class=p>[</span><span class=n>MAXE</span><span class=p>],</span> <span class=n>cost</span><span class=p>[</span><span class=n>MAXE</span><span class=p>],</span> <span class=n>tot</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>init</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>memset</span><span class=p>(</span><span class=n>head</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=k>sizeof</span><span class=p>(</span><span class=n>head</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=n>tot</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>add_edge</span><span class=p>(</span><span class=kt>int</span> <span class=n>u</span><span class=p>,</span> <span class=kt>int</span> <span class=n>v</span><span class=p>,</span> <span class=kt>int</span> <span class=n>c</span><span class=p>,</span> <span class=kt>int</span> <span class=n>w</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>to</span><span class=p>[</span><span class=n>tot</span><span class=p>]</span> <span class=o>=</span> <span class=n>v</span><span class=p>;</span> <span class=n>cap</span><span class=p>[</span><span class=n>tot</span><span class=p>]</span> <span class=o>=</span> <span class=n>c</span><span class=p>;</span> <span class=n>cost</span><span class=p>[</span><span class=n>tot</span><span class=p>]</span> <span class=o>=</span> <span class=n>w</span><span class=p>;</span> <span class=n>nxt</span><span class=p>[</span><span class=n>tot</span><span class=p>]</span> <span class=o>=</span> <span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>];</span> <span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>]</span> <span class=o>=</span> <span class=n>tot</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>to</span><span class=p>[</span><span class=n>tot</span><span class=p>]</span> <span class=o>=</span> <span class=n>u</span><span class=p>;</span> <span class=n>cap</span><span class=p>[</span><span class=n>tot</span><span class=p>]</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>cost</span><span class=p>[</span><span class=n>tot</span><span class=p>]</span> <span class=o>=</span> <span class=o>-</span><span class=n>w</span><span class=p>;</span> <span class=n>nxt</span><span class=p>[</span><span class=n>tot</span><span class=p>]</span> <span class=o>=</span> <span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>];</span> <span class=n>head</span><span class=p>[</span><span class=n>v</span><span class=p>]</span> <span class=o>=</span> <span class=n>tot</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>dist</span><span class=p>[</span><span class=n>MAXN</span><span class=p>],</span> <span class=n>in_queue</span><span class=p>[</span><span class=n>MAXN</span><span class=p>],</span> <span class=n>prevv</span><span class=p>[</span><span class=n>MAXN</span><span class=p>],</span> <span class=n>preve</span><span class=p>[</span><span class=n>MAXN</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>queue</span><span class=p>[</span><span class=n>MAXN</span> <span class=o>*</span> <span class=mi>100</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// ========== SPFA算法 ==========
</span></span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>spfa</span><span class=p>(</span><span class=kt>int</span> <span class=n>s</span><span class=p>,</span> <span class=kt>int</span> <span class=n>t</span><span class=p>,</span> <span class=kt>int</span> <span class=n>n</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>memset</span><span class=p>(</span><span class=n>dist</span><span class=p>,</span> <span class=mh>0x3f</span><span class=p>,</span> <span class=k>sizeof</span><span class=p>(</span><span class=kt>int</span><span class=p>)</span> <span class=o>*</span> <span class=p>(</span><span class=n>n</span> <span class=o>+</span> <span class=mi>1</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=nf>memset</span><span class=p>(</span><span class=n>in_queue</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=k>sizeof</span><span class=p>(</span><span class=kt>int</span><span class=p>)</span> <span class=o>*</span> <span class=p>(</span><span class=n>n</span> <span class=o>+</span> <span class=mi>1</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=n>dist</span><span class=p>[</span><span class=n>s</span><span class=p>]</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>front</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span> <span class=n>rear</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>queue</span><span class=p>[</span><span class=n>rear</span><span class=o>++</span><span class=p>]</span> <span class=o>=</span> <span class=n>s</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>in_queue</span><span class=p>[</span><span class=n>s</span><span class=p>]</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// SPFA主循环
</span></span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=p>(</span><span class=n>front</span> <span class=o>!=</span> <span class=n>rear</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>u</span> <span class=o>=</span> <span class=n>queue</span><span class=p>[</span><span class=n>front</span><span class=o>++</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=n>in_queue</span><span class=p>[</span><span class=n>u</span><span class=p>]</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 松弛边
</span></span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>e</span> <span class=o>=</span> <span class=n>head</span><span class=p>[</span><span class=n>u</span><span class=p>];</span> <span class=n>e</span> <span class=o>!=</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span> <span class=n>e</span> <span class=o>=</span> <span class=n>nxt</span><span class=p>[</span><span class=n>e</span><span class=p>])</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>cap</span><span class=p>[</span><span class=n>e</span><span class=p>]</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=o>&amp;&amp;</span> <span class=n>dist</span><span class=p>[</span><span class=n>to</span><span class=p>[</span><span class=n>e</span><span class=p>]]</span> <span class=o>&gt;</span> <span class=n>dist</span><span class=p>[</span><span class=n>u</span><span class=p>]</span> <span class=o>+</span> <span class=n>cost</span><span class=p>[</span><span class=n>e</span><span class=p>])</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>dist</span><span class=p>[</span><span class=n>to</span><span class=p>[</span><span class=n>e</span><span class=p>]]</span> <span class=o>=</span> <span class=n>dist</span><span class=p>[</span><span class=n>u</span><span class=p>]</span> <span class=o>+</span> <span class=n>cost</span><span class=p>[</span><span class=n>e</span><span class=p>];</span>
</span></span><span class=line><span class=cl>                <span class=n>prevv</span><span class=p>[</span><span class=n>to</span><span class=p>[</span><span class=n>e</span><span class=p>]]</span> <span class=o>=</span> <span class=n>u</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=n>preve</span><span class=p>[</span><span class=n>to</span><span class=p>[</span><span class=n>e</span><span class=p>]]</span> <span class=o>=</span> <span class=n>e</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>in_queue</span><span class=p>[</span><span class=n>to</span><span class=p>[</span><span class=n>e</span><span class=p>]])</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=n>queue</span><span class=p>[</span><span class=n>rear</span><span class=o>++</span><span class=p>]</span> <span class=o>=</span> <span class=n>to</span><span class=p>[</span><span class=n>e</span><span class=p>];</span>
</span></span><span class=line><span class=cl>                    <span class=n>in_queue</span><span class=p>[</span><span class=n>to</span><span class=p>[</span><span class=n>e</span><span class=p>]]</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>dist</span><span class=p>[</span><span class=n>t</span><span class=p>]</span> <span class=o>&lt;</span> <span class=n>INF</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// ========== 最小费用最大流 ==========
</span></span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>mcmf</span><span class=p>(</span><span class=kt>int</span> <span class=n>s</span><span class=p>,</span> <span class=kt>int</span> <span class=n>t</span><span class=p>,</span> <span class=kt>int</span> <span class=n>n</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>total_cost</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=p>(</span><span class=nf>spfa</span><span class=p>(</span><span class=n>s</span><span class=p>,</span> <span class=n>t</span><span class=p>,</span> <span class=n>n</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>flow</span> <span class=o>=</span> <span class=n>INF</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>v</span> <span class=o>=</span> <span class=n>t</span><span class=p>;</span> <span class=n>v</span> <span class=o>!=</span> <span class=n>s</span><span class=p>;</span> <span class=n>v</span> <span class=o>=</span> <span class=n>prevv</span><span class=p>[</span><span class=n>v</span><span class=p>])</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>cap</span><span class=p>[</span><span class=n>preve</span><span class=p>[</span><span class=n>v</span><span class=p>]]</span> <span class=o>&lt;</span> <span class=n>flow</span><span class=p>)</span> <span class=n>flow</span> <span class=o>=</span> <span class=n>cap</span><span class=p>[</span><span class=n>preve</span><span class=p>[</span><span class=n>v</span><span class=p>]];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>v</span> <span class=o>=</span> <span class=n>t</span><span class=p>;</span> <span class=n>v</span> <span class=o>!=</span> <span class=n>s</span><span class=p>;</span> <span class=n>v</span> <span class=o>=</span> <span class=n>prevv</span><span class=p>[</span><span class=n>v</span><span class=p>])</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>cap</span><span class=p>[</span><span class=n>preve</span><span class=p>[</span><span class=n>v</span><span class=p>]]</span> <span class=o>-=</span> <span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>cap</span><span class=p>[</span><span class=n>preve</span><span class=p>[</span><span class=n>v</span><span class=p>]</span> <span class=o>^</span> <span class=mi>1</span><span class=p>]</span> <span class=o>+=</span> <span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>total_cost</span> <span class=o>+=</span> <span class=n>dist</span><span class=p>[</span><span class=n>t</span><span class=p>]</span> <span class=o>*</span> <span class=n>flow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>total_cost</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>N</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nf>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>N</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>map</span><span class=p>[</span><span class=mi>10</span><span class=p>][</span><span class=mi>10</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span><span class=mi>0</span><span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>,</span> <span class=n>v</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=p>(</span><span class=nf>scanf</span><span class=p>(</span><span class=s>&#34;%d %d %d&#34;</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>x</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>y</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>v</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=p>(</span><span class=n>x</span> <span class=o>||</span> <span class=n>y</span> <span class=o>||</span> <span class=n>v</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=n>map</span><span class=p>[</span><span class=n>x</span><span class=p>][</span><span class=n>y</span><span class=p>]</span> <span class=o>=</span> <span class=n>v</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nf>init</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>S</span> <span class=o>=</span> <span class=mi>2</span> <span class=o>*</span> <span class=n>N</span> <span class=o>*</span> <span class=n>N</span> <span class=o>+</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>T</span> <span class=o>=</span> <span class=mi>2</span> <span class=o>*</span> <span class=n>N</span> <span class=o>*</span> <span class=n>N</span> <span class=o>+</span> <span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>total_nodes</span> <span class=o>=</span> <span class=n>T</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cp>#define IN(i,j)  ((i-1)*N+(j))
</span></span></span><span class=line><span class=cl>    <span class=cp>#define OUT(i,j) (N*N+(i-1)*N+(j))
</span></span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;=</span> <span class=n>N</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>j</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span> <span class=n>j</span> <span class=o>&lt;=</span> <span class=n>N</span><span class=p>;</span> <span class=n>j</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>map</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nf>add_edge</span><span class=p>(</span><span class=nf>IN</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span> <span class=nf>OUT</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span> <span class=mi>1</span><span class=p>,</span> <span class=o>-</span><span class=n>map</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>                <span class=nf>add_edge</span><span class=p>(</span><span class=nf>IN</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span> <span class=nf>OUT</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nf>add_edge</span><span class=p>(</span><span class=nf>IN</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span> <span class=nf>OUT</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>j</span> <span class=o>+</span> <span class=mi>1</span> <span class=o>&lt;=</span> <span class=n>N</span><span class=p>)</span> <span class=nf>add_edge</span><span class=p>(</span><span class=nf>OUT</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span> <span class=nf>IN</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=o>+</span><span class=mi>1</span><span class=p>),</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>i</span> <span class=o>+</span> <span class=mi>1</span> <span class=o>&lt;=</span> <span class=n>N</span><span class=p>)</span> <span class=nf>add_edge</span><span class=p>(</span><span class=nf>OUT</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>),</span> <span class=nf>IN</span><span class=p>(</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>j</span><span class=p>),</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nf>add_edge</span><span class=p>(</span><span class=n>S</span><span class=p>,</span> <span class=nf>IN</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>),</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>add_edge</span><span class=p>(</span><span class=nf>OUT</span><span class=p>(</span><span class=n>N</span><span class=p>,</span><span class=n>N</span><span class=p>),</span> <span class=n>T</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>ans</span> <span class=o>=</span> <span class=o>-</span><span class=nf>mcmf</span><span class=p>(</span><span class=n>S</span><span class=p>,</span> <span class=n>T</span><span class=p>,</span> <span class=n>total_nodes</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>ans</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>优势：可轻松扩展到 K 条路径。</p></section><footer class=article-footer><section class=article-tags><a href=/WangScape/tags/%E7%AE%97%E6%B3%95/>算法</a></section></footer></article><div class=article-comments><h3 style=margin-top:40px>💬 评论</h3><div id=comments-list class=comments-container><div style=text-align:center;color:#999;padding:40px>加载评论中...</div></div><div style="text-align:center;margin:30px 0"><button type=button class=btn-open-comment-form onclick=openCommentForm()>
💬 发表评论</button></div><div id=comment-modal class=comment-modal style=display:none data-api-base=https://wang-scape.vercel.app data-github-repo=w2343419-del/WangScape data-github-label-approved=approved data-github-label-pending=pending data-github-label-comment=comment><div class=comment-modal-content><div class=comment-modal-header><h4>💬 发表评论</h4><button type=button class=comment-modal-close onclick=closeCommentForm()>✕</button></div><div id=replying-to style=display:none;margin-bottom:10px;font-size:13px;color:#666;padding:10px;background:#f0f8ff;border-radius:4px>正在回复：<span id=replying-to-name style=font-weight:600></span>
<button type=button class=comment-reply-cancel onclick=cancelReply()>取消回复</button></div><form id=comment-form onsubmit=submitComment(event)><input type=hidden id=comment-parent-id name=parent_id><div class=form-group><label for=comment-name>姓名 *</label>
<input type=text id=comment-name name=name placeholder=您的姓名 required></div><div class=form-group><label for=comment-email>邮箱 *</label>
<input type=email id=comment-email name=email placeholder=your@email.com required>
<small style=display:block;margin-top:6px;color:#888;font-size:12px>仅站长可见，用于审核与联系，不会在网站公开展示。</small></div><div class=form-group><label for=comment-content>评论内容 *</label>
<textarea id=comment-content name=content placeholder=请输入您的评论... required rows=5></textarea></div><div class=form-group><label for=comment-images>上传图片（可选）</label>
<input type=file id=comment-images accept=image/jpeg,image/jpg,image/png,image/gif,image/webp multiple style="width:100%;padding:8px;border:1px solid #ddd;border-radius:4px"><div id=image-preview style=display:flex;gap:10px;margin-top:10px;flex-wrap:wrap></div></div><div style=display:flex;gap:10px;justify-content:flex-end><button type=button class=btn-cancel onclick=closeCommentForm()>取消</button>
<button type=submit class=btn-submit>提交评论</button></div><div id=comment-status style=margin-top:10px;text-align:center;color:#999></div></form></div></div></div><style>.article-comments{margin-top:60px;padding-top:40px;border-top:2px solid #f0f0f0}.article-comments h3{margin:0 0 30px;font-size:20px;font-weight:700}.comments-container{margin-bottom:40px}.btn-open-comment-form{background:#2b579a;color:#fff;padding:12px 32px;border:none;border-radius:6px;font-weight:600;cursor:pointer;font-size:15px;transition:all .3s;box-shadow:0 2px 8px rgba(43,87,154,.2)}.btn-open-comment-form:hover{background:#1e4073;transform:translateY(-2px);box-shadow:0 4px 12px rgba(43,87,154,.3)}.comment-modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.6);z-index:9999;display:flex;align-items:center;justify-content:center;padding:20px}.comment-modal-content{background:#fff;border-radius:12px;max-width:600px;width:100%;max-height:90vh;overflow-y:auto;box-shadow:0 10px 40px rgba(0,0,0,.3);animation:modalSlideIn .3s ease-out}@keyframes modalSlideIn{from{opacity:0;transform:translateY(-50px)}to{opacity:1;transform:translateY(0)}}.comment-modal-header{display:flex;justify-content:space-between;align-items:center;padding:20px 25px;border-bottom:1px solid #e0e0e0}.comment-modal-header h4{margin:0;font-size:18px;color:#333}.comment-modal-close{background:0 0;border:none;font-size:24px;color:#999;cursor:pointer;width:32px;height:32px;display:flex;align-items:center;justify-content:center;border-radius:4px;transition:all .2s}.comment-modal-close:hover{background:#f0f0f0;color:#333}#comment-form{padding:25px}.comment-item{padding:20px;margin-bottom:15px;background:#f9f9f9;border-radius:8px;border-left:3px solid #2b579a}.comment-children{margin-left:30px;padding-left:15px;border-left:2px dashed #e0e0e0}.comment-reply-btn{background:0 0;border:none;color:#2b579a;cursor:pointer;font-size:12px;padding:0;margin-right:15px}.comment-reply-btn:hover{text-decoration:underline}.comment-translate-btn{background:0 0;border:none;color:#ff9800;cursor:pointer;font-size:12px;padding:0}.comment-translate-btn:hover{text-decoration:underline}.comment-translate-btn:disabled{color:#ccc;cursor:not-allowed}.comment-actions{margin-top:8px;display:flex;gap:10px}.comment-translation{margin-top:10px}.comment-reply-cancel{margin-left:10px;background:0 0;border:none;color:#f44336;cursor:pointer;font-size:12px}.comment-item.pending{background:#fffbf0;border-left-color:#ff9800}.comment-author{font-weight:600;color:#333;margin-bottom:5px}.comment-meta{font-size:12px;color:#999;margin-bottom:10px}.comment-status{display:inline-block;font-size:11px;padding:2px 8px;border-radius:3px;margin-left:10px;font-weight:600}.comment-status.approved{background:#c8e6c9;color:#2e7d32}.comment-status.pending{background:#ffe0b2;color:#e65100}.comment-content{color:#555;line-height:1.6;word-break:break-word}.comment-form-wrapper{background:#f5f5f5;padding:30px;border-radius:8px;margin-top:40px}.comment-form-wrapper h4{margin:0 0 20px;font-size:16px}.form-group{margin-bottom:15px}.form-group label{display:block;margin-bottom:5px;font-weight:500;font-size:14px;color:#333}.form-group input,.form-group textarea{width:100%;padding:10px;border:1px solid #ddd;border-radius:4px;font-family:inherit;font-size:14px;box-sizing:border-box}.form-group input:focus,.form-group textarea:focus{outline:none;border-color:#2b579a;box-shadow:0 0 0 2px rgba(43,87,154,.1)}.btn-submit{background:#2b579a;color:#fff;padding:10px 24px;border:none;border-radius:4px;font-weight:600;cursor:pointer;font-size:14px;transition:background .3s}.btn-submit:hover{background:#1e4073}.btn-submit:disabled{background:#ccc;cursor:not-allowed}.btn-cancel{background:#f5f5f5;color:#666;padding:10px 24px;border:1px solid #ddd;border-radius:4px;font-weight:600;cursor:pointer;font-size:14px;transition:all .3s}.btn-cancel:hover{background:#e0e0e0;border-color:#ccc}#comment-status{display:block}@media(max-width:768px){.article-comments{margin-top:40px;padding-top:30px}.comment-form-wrapper{padding:20px}}</style><script>const currentPostPath="post/p1004-noip-2000/index.md",isZhCN="zh-cn"==="zh-cn",currentPostTitle=document.title||"P1004 [NOIP 2000 提高组] 方格取数 分析与总结",i18n={noComments:isZhCN?"暂无评论，快来抢沙发吧！":"No comments yet. Be the first!",loadFailed:isZhCN?"加载评论失败":"Failed to load comments",loadError:isZhCN?"加载评论出错:":"Error loading comments:",fillAll:isZhCN?"⚠️ 请填写所有字段":"⚠️ Please fill in all fields",submitting:isZhCN?"⏳ 提交中...":"⏳ Submitting...",uploadingImages:isZhCN?"⏳ 正在上传图片...":"⏳ Uploading images...",submitSuccess:isZhCN?"✅ 评论提交成功！等待审核后将显示在页面上。":"✅ Comment submitted! It will appear after approval.",submitFailed:isZhCN?"提交失败":"Submission failed",networkError:isZhCN?"❌ 网络错误:":"❌ Network error:",approved:isZhCN?"✓ 已批准":"✓ Approved",reply:isZhCN?"回复":"Reply",translate:isZhCN?"翻译":"Translate",showOriginal:isZhCN?"显示原文":"Show Original",translating:isZhCN?"翻译中...":"Translating...",translateFailed:isZhCN?"翻译失败":"Translation failed"};function openCommentForm(){document.getElementById("comment-modal").style.display="flex"}function closeCommentForm(){document.getElementById("comment-modal").style.display="none",document.getElementById("comment-form").reset(),document.getElementById("image-preview").innerHTML="",cancelReply(),document.getElementById("comment-status").textContent=""}document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("comment-images");e&&e.addEventListener("change",function(){const e=document.getElementById("image-preview");e.innerHTML="",Array.from(this.files).forEach((t,n)=>{const s=new FileReader;s.onload=function(t){const s=document.createElement("div");s.style.position="relative",s.innerHTML=`
                            <img src="${t.target.result}" style="width: 100px; height: 100px; object-fit: cover; border-radius: 4px; border: 1px solid #ddd;" />
                            <button type="button" onclick="removePreviewImage(${n})" style="position: absolute; top: -5px; right: -5px; background: #f44336; color: white; border: none; border-radius: 50%; width: 20px; height: 20px; cursor: pointer; font-size: 12px; line-height: 1;">×</button>
                        `,e.appendChild(s)},s.readAsDataURL(t)})})});function removePreviewImage(e){const t=document.getElementById("comment-images"),n=new DataTransfer;Array.from(t.files).forEach((t,s)=>{s!==e&&n.items.add(t)}),t.files=n.files,t.dispatchEvent(new Event("change"))}document.addEventListener("click",function(e){const t=document.getElementById("comment-modal");e.target===t&&closeCommentForm()});const commentModalEl=document.getElementById("comment-modal"),apiBase=commentModalEl&&commentModalEl.dataset&&commentModalEl.dataset.apiBase?commentModalEl.dataset.apiBase.trim():"",githubRepo=commentModalEl&&commentModalEl.dataset&&commentModalEl.dataset.githubRepo?commentModalEl.dataset.githubRepo.trim():"",githubLabelApproved=commentModalEl&&commentModalEl.dataset&&commentModalEl.dataset.githubLabelApproved?commentModalEl.dataset.githubLabelApproved.trim():"approved",githubLabelPending=commentModalEl&&commentModalEl.dataset&&commentModalEl.dataset.githubLabelPending?commentModalEl.dataset.githubLabelPending.trim():"pending",githubLabelComment=commentModalEl&&commentModalEl.dataset&&commentModalEl.dataset.githubLabelComment?commentModalEl.dataset.githubLabelComment.trim():"comment";function buildApiUrl(e){return apiBase?apiBase.replace(/\/$/,"")+e:e}function useGithubComments(){return!!githubRepo}function extractCommentField(e,t){const s=new RegExp("^"+t+"\\s*:\\s*(.*)$","mi"),n=e.match(s);return n?n[1].trim():""}function extractCommentContent(e){const t="Content:",n=e.indexOf(t);return n===-1?e.trim():e.slice(n+t.length).trim()}async function loadComments(){try{if(useGithubComments()){const s=encodeURIComponent(githubLabelComment+","+githubLabelApproved),o="https://api.github.com/repos/"+githubRepo+"/issues?state=open&per_page=100&labels="+s,i=await fetch(o),t=await i.json();let e="";const n=Array.isArray(t)?t.filter(e=>{if(!e||!e.body)return!1;const t=extractCommentField(e.body,"Post");return t===currentPostPath}):[];if(n.length>0){const t=n.map(e=>({Id:String(e.id),Author:extractCommentField(e.body,"Author")||(e.user?e.user.login:"GitHub"),Email:extractCommentField(e.body,"Email")||"",Content:extractCommentContent(e.body),Time:e.created_at||"",ParentID:"",Approved:!0})),s=buildCommentTree(t);s.forEach(t=>{e+=renderCommentItem(t)})}else e='<div style="text-align: center; color: #999; padding: 40px;">'+i18n.noComments+"</div>";document.getElementById("comments-list").innerHTML=e}else{const n=await fetch(buildApiUrl("/api/comments?path="+encodeURIComponent(currentPostPath))),e=await n.json();let t="";if(e.data&&e.data.length>0){const n=buildCommentTree(e.data);n.forEach(e=>{t+=renderCommentItem(e)})}else t='<div style="text-align: center; color: #999; padding: 40px;">'+i18n.noComments+"</div>";document.getElementById("comments-list").innerHTML=t}}catch(e){document.getElementById("comments-list").innerHTML='<div style="color: red; padding: 20px;">'+i18n.loadFailed+"</div>",console.error(i18n.loadError,e)}}async function submitComment(e){e.preventDefault();const n=document.getElementById("comment-name").value.trim(),s=document.getElementById("comment-email").value.trim(),o=document.getElementById("comment-content").value.trim(),a=document.getElementById("comment-parent-id").value,r=document.getElementById("comment-images"),t=document.getElementById("comment-status"),i=e.target.querySelector(".btn-submit");if(!n||!s||!o){t.textContent=i18n.fillAll,t.style.color="#f44336";return}i.disabled=!0,t.textContent=i18n.submitting,t.style.color="#ff9800";try{const r={post_path:currentPostPath,post_title:document.title||currentPostPath,author:n,email:s,content:o,parent_id:a||"",use_github:useGithubComments(),github_repo:githubRepo,github_labels:[githubLabelComment,githubLabelPending]},e=await fetch(buildApiUrl("/api"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!e.ok){const t=await e.text();throw new Error(`HTTP ${e.status}: ${t.substring(0,100)}`)}const i=await e.json();i.success?(t.textContent=i18n.submitSuccess,t.style.color="#4CAF50",setTimeout(()=>{closeCommentForm(),loadComments()},2e3)):(t.textContent="❌ "+(i.message||i18n.submitFailed),t.style.color="#f44336")}catch(e){t.textContent=i18n.networkError+" "+e,t.style.color="#f44336",console.error(i18n.loadError,e)}finally{i.disabled=!1}}function escapeHtml(e){const t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,e=>t[e])}function buildCommentTree(e){const t={},n=[];return e.forEach(e=>{e.children=[],t[e.id]=e}),e.forEach(e=>{e.parent_id&&t[e.parent_id]?t[e.parent_id].children.push(e):n.push(e)}),n}function renderCommentItem(e){const s=(e.author||"").replace(/'/g,"\\'");let t="";e.images&&e.images.length>0&&(t='<div class="comment-images" style="margin-top: 10px; display: flex; gap: 10px; flex-wrap: wrap;">',e.images.forEach(e=>{t+=`<img src="${escapeHtml(e)}" style="max-width: 200px; max-height: 200px; border-radius: 4px; cursor: pointer; object-fit: cover;" onclick="window.open('${escapeHtml(e)}', '_blank')" />`}),t+="</div>");let n=`
            <div class="comment-item">
                <div class="comment-author">
                    ${escapeHtml(e.author)}
                    <span class="comment-status approved">${i18n.approved}</span>
                </div>
                <div class="comment-meta">
                    ${e.timestamp}
                </div>
                <div class="comment-content" id="comment-content-${e.id}">
                    ${escapeHtml(e.content).replace(/\n/g,"<br>")}
                </div>
                ${t}
                <div class="comment-actions">
                    <button class="comment-reply-btn" onclick="startReply('${e.id}', '${s}')">${i18n.reply}</button>
                    <button class="comment-translate-btn" id="translate-btn-${e.id}" onclick="toggleTranslate('${e.id}', \`${escapeHtml(e.content).replace(/`/g,"\\`")}\`)">${i18n.translate}</button>
                </div>
                <div class="comment-translation" id="translation-${e.id}" style="display: none;"></div>
            </div>
        `;return e.children&&e.children.length>0&&(n+='<div class="comment-children">',e.children.forEach(e=>{n+=renderCommentItem(e)}),n+="</div>"),n}function startReply(e,t){document.getElementById("comment-parent-id").value=e,document.getElementById("replying-to-name").textContent=t,document.getElementById("replying-to").style.display="block",openCommentForm(),document.getElementById("comment-content").focus()}function cancelReply(){document.getElementById("comment-parent-id").value="",document.getElementById("replying-to").style.display="none",document.getElementById("replying-to-name").textContent=""}async function toggleTranslate(e,t){const n=document.getElementById("translation-"+e),s=document.getElementById("translate-btn-"+e),o=document.getElementById("comment-content-"+e);if(n.style.display!=="none"){n.style.display="none",o.style.display="block",s.textContent=i18n.translate;return}if(n.dataset.translated==="true"){n.style.display="block",o.style.display="none",s.textContent=i18n.showOriginal;return}s.textContent=i18n.translating,s.disabled=!0;try{const i=isZhCN?"zh-CN":"en",a=await fetch(`https://translate.googleapis.com/translate_a/single?client=gtx&sl=auto&tl=${i}&dt=t&q=`+encodeURIComponent(t)),e=await a.json();if(e&&e[0]){const t=e[0].map(e=>e[0]).join("");n.innerHTML='<div style="padding: 10px; background: #f0f8ff; border-left: 3px solid #2b579a; border-radius: 4px; margin-top: 10px;">'+escapeHtml(t).replace(/\n/g,"<br>")+"</div>",n.dataset.translated="true",n.style.display="block",o.style.display="none",s.textContent=i18n.showOriginal}else throw new Error("Translation failed")}catch(e){n.innerHTML='<div style="color: #f44336; font-size: 12px; margin-top: 5px;">'+i18n.translateFailed+"</div>",n.style.display="block",s.textContent=i18n.translate,console.error("Translation error:",e)}finally{s.disabled=!1}}document.addEventListener("DOMContentLoaded",function(){loadComments()}),(document.readyState==="interactive"||document.readyState==="complete")&&loadComments()</script><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/WangScape/ts/main.c922af694cc257bf1ecc41c0dd7b0430f9114ec280ccf67cd2c6ad55f5316c4e.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script><script>document.body.classList.add("animated-loading"),window.addEventListener("DOMContentLoaded",function(){var e=document.querySelector(".left-sidebar");e?(e.style.minHeight=window.innerHeight+"px",e.addEventListener("animationend",function(){document.body.classList.remove("animated-loading"),e.style.minHeight=""},{once:!0})):document.body.classList.remove("animated-loading")})</script></body></html>