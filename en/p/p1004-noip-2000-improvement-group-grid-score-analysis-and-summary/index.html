<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="date: 2026-02-28T11:31:04+08:00"><title>P1004 [NOIP 2000 improvement group] grid score analysis and summary</title><link rel=canonical href=https://w2343419-del.github.io/WangScape/en/p/p1004-noip-2000-improvement-group-grid-score-analysis-and-summary/><link rel=stylesheet href=/WangScape/scss/style.min.6059284a08e53c8e4251c184daa78a3d1444603df1ba77b060ea15a51a336941.css><meta property='og:title' content="P1004 [NOIP 2000 improvement group] grid score analysis and summary"><meta property='og:description' content="date: 2026-02-28T11:31:04+08:00"><meta property='og:url' content='https://w2343419-del.github.io/WangScape/en/p/p1004-noip-2000-improvement-group-grid-score-analysis-and-summary/'><meta property='og:site_name' content='WangScape'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='ÁÆóÊ≥ï'><meta property='article:published_time' content='2026-02-28T11:31:00+08:00'><meta property='article:modified_time' content='2026-02-28T11:31:00+08:00'><meta name=twitter:title content="P1004 [NOIP 2000 improvement group] grid score analysis and summary"><meta name=twitter:description content="date: 2026-02-28T11:31:04+08:00"><link rel="shortcut icon" href=/WangScape/favicon.png><script async src=https://unknown-qzthzzic4-w2343419-dels-projects.vercel.app/script.js data-website-id=aee9b0a3-00c8-4037-8b99-e6bb4c336cb9></script><script>function getPageViews(e){const t="page_views_"+e.replace(/\//g,"_");return parseInt(localStorage.getItem(t)||"0")}function incrementPageViews(e){const n="page_views_"+e.replace(/\//g,"_");let t=getPageViews(e);return t++,localStorage.setItem(n,t.toString()),t}document.addEventListener("DOMContentLoaded",function(){const e=window.location.pathname,t=document.querySelector("[data-umami-page-pv] .umami-value");if(t&&e.includes("/p/")){const n=incrementPageViews(e);t.innerText=n}setTimeout(function(){document.querySelectorAll("[data-umami-page-pv] .umami-value").forEach(function(e){if(e.innerText!=="0")return;const t=e.closest("article");if(!t)return;const n=t.querySelector('a[href*="/p/"]');if(!n)return;const s=new URL(n.href,window.location.origin).pathname,o=getPageViews(s);e.innerText=o})},100)})</script><script>document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll(".article-list article").forEach(function(e){e.addEventListener("click",function(t){if(t.target.tagName==="A"||t.target.closest("a"))return;const n=e.querySelector(".article-title a");n&&(window.location.href=n.href)})})})</script><script>document.addEventListener("DOMContentLoaded",function(){const e=document.querySelector(".main");if(!e)return;const t=document.createElement("div");t.className="scroll-indicator",t.innerHTML=`
            <div class="indicator-text">ÊªöÂä®</div>
            <div class="indicator-arrow"></div>
        `,document.body.appendChild(t);function n(){const s=e.scrollTop,o=e.scrollHeight,i=e.clientHeight,n=o-i;n>100&&s<n*.9?t.classList.add("show"):t.classList.remove("show")}setTimeout(n,500),e.addEventListener("scroll",n),window.addEventListener("resize",n)})</script><script src=/WangScape/js/pagination-enhanced.js></script><script src=/WangScape/js/ultra-simple-paginator.js></script></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><img src=/WangScape/img/avatar_hu_499b94489a20731a.png width=150 height=150 class=site-logo alt=Avatar></figure><div class=site-meta><h1 class=site-name><a href=/WangScape/en>WangScape</a></h1><h2 class=site-description>Waiting for flowers when leaving...</h2></div></header><ol class=menu id=main-menu><li><a href=/WangScape/en/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/WangScape/en/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/WangScape/en/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/WangScape/en/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li></ol><div class=sidebar-footer-controls><a href=https://w2343419-del.github.io/WangScape/p/p1004-noip-2000-%E6%8F%90%E9%AB%98%E7%BB%84-%E6%96%B9%E6%A0%BC%E5%8F%96%E6%95%B0-%E5%88%86%E6%9E%90%E4%B8%8E%E6%80%BB%E7%BB%93/ id=lang-switch class=lang-switch-btn title="ÂàáÊç¢Ëá≥ ‰∏≠Êñá"><svg class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg>
<span>‰∏≠Êñá</span></a><div id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></div></div></aside><div id=avatar-modal class=avatar-modal><div class=avatar-modal-overlay></div><div class=avatar-modal-content><img src alt=Avatar class=avatar-modal-img></div></div><script>(function(){const n=document.querySelector(".avatar-link"),e=document.getElementById("avatar-modal"),s=e.querySelector(".avatar-modal-img"),o=e.querySelector(".avatar-modal-overlay");if(n&&e){n.addEventListener("click",function(t){t.preventDefault();const n=this.getAttribute("data-avatar");s.src=n,e.classList.add("active"),document.body.style.overflow="hidden"});function t(){e.classList.remove("active"),document.body.style.overflow=""}o.addEventListener("click",t),e.querySelector(".avatar-modal-content").addEventListener("click",t),document.addEventListener("keydown",function(n){n.key==="Escape"&&e.classList.contains("active")&&t()})}})()</script><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/WangScape/en/categories/%E7%AE%97%E6%B3%95/>ÁÆóÊ≥ï</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/WangScape/en/p/p1004-noip-2000-improvement-group-grid-score-analysis-and-summary/>P1004 [NOIP 2000 improvement group] grid score analysis and summary</a></h2><h3 class=article-subtitle>date: 2026-02-28T11:31:04+08:00</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published datetime=2026-02-28T11:31:00+08:00>Feb 28, 2026</time></div><div class=article-views><svg class="icon icon-tabler icon-tabler-eye" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M10 12a2 2 0 104 0 2 2 0 00-4 0"/><path d="M21 12c-2.4 4-5.4 6-9 6s-6.6-2-9-6c2.4-4 5.4-6 9-6s6.6 2 9 6"/></svg>
<span class=umami-views data-umami-page-pv><span class=umami-value>0</span> views</span></div></footer><footer class=article-translations><svg class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg><div><a href=https://w2343419-del.github.io/WangScape/p/p1004-noip-2000-%E6%8F%90%E9%AB%98%E7%BB%84-%E6%96%B9%E6%A0%BC%E5%8F%96%E6%95%B0-%E5%88%86%E6%9E%90%E4%B8%8E%E6%80%BB%E7%BB%93/ class=link>‰∏≠Êñá</a></div></footer></div></header><section class=article-content><p>This is a classic but difficult chessboard model problem. Although it is a NOIP problem in 2000, it is still quite difficult for first-time contacts like me as the finale.</p><p>Look at the background of the question first</p><p>NOIP 2000 improvement group T4</p><p>Question description
There is a square diagram of N √ó N (N ‚â§ 9), some of which we fill in positive integers, while others put the number 0.</p><p>Someone starts at point A (0, 0) in the top left corner of the diagram and can walk down or to the right until they reach point B (N, N) in the bottom right corner. On the way he walks, he can take the number in the square (which becomes the number 0).</p><p>This person walked from point A to point B twice, trying to find 2 such paths, so that the sum of the obtained numbers is the maximum.</p><p>Input format
The first line of the input is an integer N (representing the grid diagram of N √ó N), the next row has three integers, the first two represent the position, and the third number is the number put on the position.A separate line of 0 indicates the end of the input.</p><p>Output format
Just output an integer representing the maximum sum obtained on the 2 paths.</p><p>Sample input/output
Input
8
2 3 13
2 6 6
3 5 7
4 4 14
5 2 21
5 6 4
6 3 15
7 2 14
0 0 0</p><p>Output
67</p><p>Instructions/Tips
Data range: 1 ‚â§ N ‚â§ 9.</p><p>I initially tried to enumerate the matrix that had been changed (that is, simulated) again after a round of enumeration, but found that the difficulty was a little too great. Finally, I couldn&rsquo;t think of a solution, so I found Claude&rsquo;s teacher. The solution it gave was to use the dp algorithm (see method 1 for details). I thought of the algorithm of DFS combined with pruning (thank you for the maze problem I did before, it is an algorithm problem related to the minimum number of steps, which is just suitable for DFS combined with pruning) (see method 2 for details). Later, Claude also gave an algorithm that is suitable for general solutions - the cost flow solution method (too difficult, belonging to the hyper-schema solution method, sketching one or two, see method 3 for details).</p><p>ps. Explain why two enums cannot be taken. One path changes the map, affecting the second, so the two paths must be considered in conjunction.</p><p>Solution 1 (dp dynamic programming):</p><p>Core idea: Advance both paths simultaneously and simulate two people walking at the same time with one DP.</p><p>State design: set dp [k] [x1] [x2], where:</p><p>k is the number of steps currently taken (i.e. the value of x + y, from 2 to 2N)
x1 and x2 are the line numbers where the two people are currently located.
By k and x can be derived y = k - x (key, this step reduces the dimension), so the column number does not need to be stored separately</p><p>Deduplication: When two people are in the same cell (x1 = = x2, then y1 = = y2), the cell is taken only once.</p><p>Transfer: Two people each can choose to move to the right or down for a total of 4 combinations.</p><p>Full code __ code_block_0 __\ n\ n</p><p>Time complexity: O (N ¬≥)</p><p>Solution 2 (DFS + pruning):</p><p>Core idea: Similar to the dp algorithm (after all, deep search and dp are essentially one thing), but adds the step of memorized search, avoiding repetitive searches. (If there is no memory search, the amount of calculation will be an exponential explosion, about 4 ^ 16 times at N = 9)</p><p>Full code __ code_block_1 __\ n\ n</p><p>Time complexity: O (N ¬≥)</p><p>Solution 3 (Cost Flow Solution):</p><p>Core idea: Convert &ldquo;maximizing the two paths&rdquo; into a network flow problem.</p><p>Modeling Ideas
Key Observations:
Two paths from A to B = 2 flows from source to sink
Fetch at most once per cell = 1 capacity per node
Get number max = cost max (min to min)</p><p>Split point: Each grid (i, j) is split into two nodes in and out:
in ‚Üí out: Capacity 1, Cost -map [i] [j] (minimize costs by minimizing costs)
in ‚Üí out: add one more capacity 1, cost 0 (allow the second path to go through but do not take repeated values)
Namely: Consolidated to Capacity 2, but only the first unit stream has revenue</p><p>Connected edges: (i, j) out connects (i +1, j) in and (i, j +1) in, capacity 2, cost 0.</p><p>Source sink: The source point S is connected to (1,1) .in, (N, N) .out is connected to the sink point T, and the traffic is 2.</p><p>After splitting each grid (i, j):</p><p>Capacity 1, cost-val (first way through, take the number)
in (i, j) = = = = = = = = = = = = = = = = > out (i, j)
Capacity 1, cost 0 (second way through, number taken)</p><p>Full code (MCMF, SPFA implementation) __ code_block_2 __\ n\ n</p><p>Time complexity: O (E ¬∑ SPFA)</p><p>Advantage: Easily scales to K paths.</p></section><footer class=article-footer><section class=article-tags><a href=/WangScape/en/tags/%E7%AE%97%E6%B3%95/>ÁÆóÊ≥ï</a></section></footer></article><div class=article-comments><h3 style=margin-top:40px>üí¨ Comments</h3><div id=comments-list class=comments-container><div style=text-align:center;color:#999;padding:40px>Loading comments...</div></div><div style="text-align:center;margin:30px 0"><button type=button class=btn-open-comment-form onclick=openCommentForm()>
üí¨ Post a Comment</button></div><div id=comment-modal class=comment-modal style=display:none data-api-base=https://wang-scape.vercel.app data-github-repo=w2343419-del/WangScape data-github-label-approved=approved data-github-label-pending=pending data-github-label-comment=comment><div class=comment-modal-content><div class=comment-modal-header><h4>üí¨ Post a Comment</h4><button type=button class=comment-modal-close onclick=closeCommentForm()>‚úï</button></div><div id=replying-to style=display:none;margin-bottom:10px;font-size:13px;color:#666;padding:10px;background:#f0f8ff;border-radius:4px>Replying to: <span id=replying-to-name style=font-weight:600></span>
<button type=button class=comment-reply-cancel onclick=cancelReply()>Cancel</button></div><form id=comment-form onsubmit=submitComment(event)><input type=hidden id=comment-parent-id name=parent_id><div class=form-group><label for=comment-name>Name *</label>
<input type=text id=comment-name name=name placeholder="Your name" required></div><div class=form-group><label for=comment-email>Email *</label>
<input type=email id=comment-email name=email placeholder=your@email.com required>
<small style=display:block;margin-top:6px;color:#888;font-size:12px>Visible to site owner only for moderation; not shown publicly.</small></div><div class=form-group><label for=comment-content>Comment *</label>
<textarea id=comment-content name=content placeholder="Write your comment..." required rows=5></textarea></div><div class=form-group><label for=comment-images>Upload Images (Optional)</label>
<input type=file id=comment-images accept=image/jpeg,image/jpg,image/png,image/gif,image/webp multiple style="width:100%;padding:8px;border:1px solid #ddd;border-radius:4px"><div id=image-preview style=display:flex;gap:10px;margin-top:10px;flex-wrap:wrap></div></div><div style=display:flex;gap:10px;justify-content:flex-end><button type=button class=btn-cancel onclick=closeCommentForm()>Cancel</button>
<button type=submit class=btn-submit>Submit</button></div><div id=comment-status style=margin-top:10px;text-align:center;color:#999></div></form></div></div></div><style>.article-comments{margin-top:60px;padding-top:40px;border-top:2px solid #f0f0f0}.article-comments h3{margin:0 0 30px;font-size:20px;font-weight:700}.comments-container{margin-bottom:40px}.btn-open-comment-form{background:#2b579a;color:#fff;padding:12px 32px;border:none;border-radius:6px;font-weight:600;cursor:pointer;font-size:15px;transition:all .3s;box-shadow:0 2px 8px rgba(43,87,154,.2)}.btn-open-comment-form:hover{background:#1e4073;transform:translateY(-2px);box-shadow:0 4px 12px rgba(43,87,154,.3)}.comment-modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.6);z-index:9999;display:flex;align-items:center;justify-content:center;padding:20px}.comment-modal-content{background:#fff;border-radius:12px;max-width:600px;width:100%;max-height:90vh;overflow-y:auto;box-shadow:0 10px 40px rgba(0,0,0,.3);animation:modalSlideIn .3s ease-out}@keyframes modalSlideIn{from{opacity:0;transform:translateY(-50px)}to{opacity:1;transform:translateY(0)}}.comment-modal-header{display:flex;justify-content:space-between;align-items:center;padding:20px 25px;border-bottom:1px solid #e0e0e0}.comment-modal-header h4{margin:0;font-size:18px;color:#333}.comment-modal-close{background:0 0;border:none;font-size:24px;color:#999;cursor:pointer;width:32px;height:32px;display:flex;align-items:center;justify-content:center;border-radius:4px;transition:all .2s}.comment-modal-close:hover{background:#f0f0f0;color:#333}#comment-form{padding:25px}.comment-item{padding:20px;margin-bottom:15px;background:#f9f9f9;border-radius:8px;border-left:3px solid #2b579a}.comment-children{margin-left:30px;padding-left:15px;border-left:2px dashed #e0e0e0}.comment-reply-btn{background:0 0;border:none;color:#2b579a;cursor:pointer;font-size:12px;padding:0;margin-right:15px}.comment-reply-btn:hover{text-decoration:underline}.comment-translate-btn{background:0 0;border:none;color:#ff9800;cursor:pointer;font-size:12px;padding:0}.comment-translate-btn:hover{text-decoration:underline}.comment-translate-btn:disabled{color:#ccc;cursor:not-allowed}.comment-actions{margin-top:8px;display:flex;gap:10px}.comment-translation{margin-top:10px}.comment-reply-cancel{margin-left:10px;background:0 0;border:none;color:#f44336;cursor:pointer;font-size:12px}.comment-item.pending{background:#fffbf0;border-left-color:#ff9800}.comment-author{font-weight:600;color:#333;margin-bottom:5px}.comment-meta{font-size:12px;color:#999;margin-bottom:10px}.comment-status{display:inline-block;font-size:11px;padding:2px 8px;border-radius:3px;margin-left:10px;font-weight:600}.comment-status.approved{background:#c8e6c9;color:#2e7d32}.comment-status.pending{background:#ffe0b2;color:#e65100}.comment-content{color:#555;line-height:1.6;word-break:break-word}.comment-form-wrapper{background:#f5f5f5;padding:30px;border-radius:8px;margin-top:40px}.comment-form-wrapper h4{margin:0 0 20px;font-size:16px}.form-group{margin-bottom:15px}.form-group label{display:block;margin-bottom:5px;font-weight:500;font-size:14px;color:#333}.form-group input,.form-group textarea{width:100%;padding:10px;border:1px solid #ddd;border-radius:4px;font-family:inherit;font-size:14px;box-sizing:border-box}.form-group input:focus,.form-group textarea:focus{outline:none;border-color:#2b579a;box-shadow:0 0 0 2px rgba(43,87,154,.1)}.btn-submit{background:#2b579a;color:#fff;padding:10px 24px;border:none;border-radius:4px;font-weight:600;cursor:pointer;font-size:14px;transition:background .3s}.btn-submit:hover{background:#1e4073}.btn-submit:disabled{background:#ccc;cursor:not-allowed}.btn-cancel{background:#f5f5f5;color:#666;padding:10px 24px;border:1px solid #ddd;border-radius:4px;font-weight:600;cursor:pointer;font-size:14px;transition:all .3s}.btn-cancel:hover{background:#e0e0e0;border-color:#ccc}#comment-status{display:block}@media(max-width:768px){.article-comments{margin-top:40px;padding-top:30px}.comment-form-wrapper{padding:20px}}</style><script>const currentPostPath="post/p1004-noip-2000/index.md",isZhCN="en"==="zh-cn",currentPostTitle=document.title||"P1004 [NOIP 2000 improvement group] grid score analysis and summary",i18n={noComments:isZhCN?"ÊöÇÊó†ËØÑËÆ∫ÔºåÂø´Êù•Êä¢Ê≤ôÂèëÂêßÔºÅ":"No comments yet. Be the first!",loadFailed:isZhCN?"Âä†ËΩΩËØÑËÆ∫Â§±Ë¥•":"Failed to load comments",loadError:isZhCN?"Âä†ËΩΩËØÑËÆ∫Âá∫Èîô:":"Error loading comments:",fillAll:isZhCN?"‚ö†Ô∏è ËØ∑Â°´ÂÜôÊâÄÊúâÂ≠óÊÆµ":"‚ö†Ô∏è Please fill in all fields",submitting:isZhCN?"‚è≥ Êèê‰∫§‰∏≠...":"‚è≥ Submitting...",uploadingImages:isZhCN?"‚è≥ Ê≠£Âú®‰∏ä‰º†ÂõæÁâá...":"‚è≥ Uploading images...",submitSuccess:isZhCN?"‚úÖ ËØÑËÆ∫Êèê‰∫§ÊàêÂäüÔºÅÁ≠âÂæÖÂÆ°Ê†∏ÂêéÂ∞ÜÊòæÁ§∫Âú®È°µÈù¢‰∏ä„ÄÇ":"‚úÖ Comment submitted! It will appear after approval.",submitFailed:isZhCN?"Êèê‰∫§Â§±Ë¥•":"Submission failed",networkError:isZhCN?"‚ùå ÁΩëÁªúÈîôËØØ:":"‚ùå Network error:",approved:isZhCN?"‚úì Â∑≤ÊâπÂáÜ":"‚úì Approved",reply:isZhCN?"ÂõûÂ§ç":"Reply",translate:isZhCN?"ÁøªËØë":"Translate",showOriginal:isZhCN?"ÊòæÁ§∫ÂéüÊñá":"Show Original",translating:isZhCN?"ÁøªËØë‰∏≠...":"Translating...",translateFailed:isZhCN?"ÁøªËØëÂ§±Ë¥•":"Translation failed"};function openCommentForm(){document.getElementById("comment-modal").style.display="flex"}function closeCommentForm(){document.getElementById("comment-modal").style.display="none",document.getElementById("comment-form").reset(),document.getElementById("image-preview").innerHTML="",cancelReply(),document.getElementById("comment-status").textContent=""}document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("comment-images");e&&e.addEventListener("change",function(){const e=document.getElementById("image-preview");e.innerHTML="",Array.from(this.files).forEach((t,n)=>{const s=new FileReader;s.onload=function(t){const s=document.createElement("div");s.style.position="relative",s.innerHTML=`
                            <img src="${t.target.result}" style="width: 100px; height: 100px; object-fit: cover; border-radius: 4px; border: 1px solid #ddd;" />
                            <button type="button" onclick="removePreviewImage(${n})" style="position: absolute; top: -5px; right: -5px; background: #f44336; color: white; border: none; border-radius: 50%; width: 20px; height: 20px; cursor: pointer; font-size: 12px; line-height: 1;">√ó</button>
                        `,e.appendChild(s)},s.readAsDataURL(t)})})});function removePreviewImage(e){const t=document.getElementById("comment-images"),n=new DataTransfer;Array.from(t.files).forEach((t,s)=>{s!==e&&n.items.add(t)}),t.files=n.files,t.dispatchEvent(new Event("change"))}document.addEventListener("click",function(e){const t=document.getElementById("comment-modal");e.target===t&&closeCommentForm()});const commentModalEl=document.getElementById("comment-modal"),apiBase=commentModalEl&&commentModalEl.dataset&&commentModalEl.dataset.apiBase?commentModalEl.dataset.apiBase.trim():"",githubRepo=commentModalEl&&commentModalEl.dataset&&commentModalEl.dataset.githubRepo?commentModalEl.dataset.githubRepo.trim():"",githubLabelApproved=commentModalEl&&commentModalEl.dataset&&commentModalEl.dataset.githubLabelApproved?commentModalEl.dataset.githubLabelApproved.trim():"approved",githubLabelPending=commentModalEl&&commentModalEl.dataset&&commentModalEl.dataset.githubLabelPending?commentModalEl.dataset.githubLabelPending.trim():"pending",githubLabelComment=commentModalEl&&commentModalEl.dataset&&commentModalEl.dataset.githubLabelComment?commentModalEl.dataset.githubLabelComment.trim():"comment";function buildApiUrl(e){return apiBase?apiBase.replace(/\/$/,"")+e:e}function useGithubComments(){return!!githubRepo}function extractCommentField(e,t){const s=new RegExp("^"+t+"\\s*:\\s*(.*)$","mi"),n=e.match(s);return n?n[1].trim():""}function extractCommentContent(e){const t="Content:",n=e.indexOf(t);return n===-1?e.trim():e.slice(n+t.length).trim()}async function loadComments(){try{if(useGithubComments()){const s=encodeURIComponent(githubLabelComment+","+githubLabelApproved),o="https://api.github.com/repos/"+githubRepo+"/issues?state=open&per_page=100&labels="+s,i=await fetch(o),t=await i.json();let e="";const n=Array.isArray(t)?t.filter(e=>{if(!e||!e.body)return!1;const t=extractCommentField(e.body,"Post");return t===currentPostPath}):[];if(n.length>0){const t=n.map(e=>({Id:String(e.id),Author:extractCommentField(e.body,"Author")||(e.user?e.user.login:"GitHub"),Email:extractCommentField(e.body,"Email")||"",Content:extractCommentContent(e.body),Time:e.created_at||"",ParentID:"",Approved:!0})),s=buildCommentTree(t);s.forEach(t=>{e+=renderCommentItem(t)})}else e='<div style="text-align: center; color: #999; padding: 40px;">'+i18n.noComments+"</div>";document.getElementById("comments-list").innerHTML=e}else{const n=await fetch(buildApiUrl("/api/comments?path="+encodeURIComponent(currentPostPath))),e=await n.json();let t="";if(e.data&&e.data.length>0){const n=buildCommentTree(e.data);n.forEach(e=>{t+=renderCommentItem(e)})}else t='<div style="text-align: center; color: #999; padding: 40px;">'+i18n.noComments+"</div>";document.getElementById("comments-list").innerHTML=t}}catch(e){document.getElementById("comments-list").innerHTML='<div style="color: red; padding: 20px;">'+i18n.loadFailed+"</div>",console.error(i18n.loadError,e)}}async function submitComment(e){e.preventDefault();const n=document.getElementById("comment-name").value.trim(),s=document.getElementById("comment-email").value.trim(),o=document.getElementById("comment-content").value.trim(),a=document.getElementById("comment-parent-id").value,r=document.getElementById("comment-images"),t=document.getElementById("comment-status"),i=e.target.querySelector(".btn-submit");if(!n||!s||!o){t.textContent=i18n.fillAll,t.style.color="#f44336";return}i.disabled=!0,t.textContent=i18n.submitting,t.style.color="#ff9800";try{const r={post_path:currentPostPath,post_title:document.title||currentPostPath,author:n,email:s,content:o,parent_id:a||"",use_github:useGithubComments(),github_repo:githubRepo,github_labels:[githubLabelComment,githubLabelPending]},e=await fetch(buildApiUrl("/api"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!e.ok){const t=await e.text();throw new Error(`HTTP ${e.status}: ${t.substring(0,100)}`)}const i=await e.json();i.success?(t.textContent=i18n.submitSuccess,t.style.color="#4CAF50",setTimeout(()=>{closeCommentForm(),loadComments()},2e3)):(t.textContent="‚ùå "+(i.message||i18n.submitFailed),t.style.color="#f44336")}catch(e){t.textContent=i18n.networkError+" "+e,t.style.color="#f44336",console.error(i18n.loadError,e)}finally{i.disabled=!1}}function escapeHtml(e){const t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,e=>t[e])}function buildCommentTree(e){const t={},n=[];return e.forEach(e=>{e.children=[],t[e.id]=e}),e.forEach(e=>{e.parent_id&&t[e.parent_id]?t[e.parent_id].children.push(e):n.push(e)}),n}function renderCommentItem(e){const s=(e.author||"").replace(/'/g,"\\'");let t="";e.images&&e.images.length>0&&(t='<div class="comment-images" style="margin-top: 10px; display: flex; gap: 10px; flex-wrap: wrap;">',e.images.forEach(e=>{t+=`<img src="${escapeHtml(e)}" style="max-width: 200px; max-height: 200px; border-radius: 4px; cursor: pointer; object-fit: cover;" onclick="window.open('${escapeHtml(e)}', '_blank')" />`}),t+="</div>");let n=`
            <div class="comment-item">
                <div class="comment-author">
                    ${escapeHtml(e.author)}
                    <span class="comment-status approved">${i18n.approved}</span>
                </div>
                <div class="comment-meta">
                    ${e.timestamp}
                </div>
                <div class="comment-content" id="comment-content-${e.id}">
                    ${escapeHtml(e.content).replace(/\n/g,"<br>")}
                </div>
                ${t}
                <div class="comment-actions">
                    <button class="comment-reply-btn" onclick="startReply('${e.id}', '${s}')">${i18n.reply}</button>
                    <button class="comment-translate-btn" id="translate-btn-${e.id}" onclick="toggleTranslate('${e.id}', \`${escapeHtml(e.content).replace(/`/g,"\\`")}\`)">${i18n.translate}</button>
                </div>
                <div class="comment-translation" id="translation-${e.id}" style="display: none;"></div>
            </div>
        `;return e.children&&e.children.length>0&&(n+='<div class="comment-children">',e.children.forEach(e=>{n+=renderCommentItem(e)}),n+="</div>"),n}function startReply(e,t){document.getElementById("comment-parent-id").value=e,document.getElementById("replying-to-name").textContent=t,document.getElementById("replying-to").style.display="block",openCommentForm(),document.getElementById("comment-content").focus()}function cancelReply(){document.getElementById("comment-parent-id").value="",document.getElementById("replying-to").style.display="none",document.getElementById("replying-to-name").textContent=""}async function toggleTranslate(e,t){const n=document.getElementById("translation-"+e),s=document.getElementById("translate-btn-"+e),o=document.getElementById("comment-content-"+e);if(n.style.display!=="none"){n.style.display="none",o.style.display="block",s.textContent=i18n.translate;return}if(n.dataset.translated==="true"){n.style.display="block",o.style.display="none",s.textContent=i18n.showOriginal;return}s.textContent=i18n.translating,s.disabled=!0;try{const i=isZhCN?"zh-CN":"en",a=await fetch(`https://translate.googleapis.com/translate_a/single?client=gtx&sl=auto&tl=${i}&dt=t&q=`+encodeURIComponent(t)),e=await a.json();if(e&&e[0]){const t=e[0].map(e=>e[0]).join("");n.innerHTML='<div style="padding: 10px; background: #f0f8ff; border-left: 3px solid #2b579a; border-radius: 4px; margin-top: 10px;">'+escapeHtml(t).replace(/\n/g,"<br>")+"</div>",n.dataset.translated="true",n.style.display="block",o.style.display="none",s.textContent=i18n.showOriginal}else throw new Error("Translation failed")}catch(e){n.innerHTML='<div style="color: #f44336; font-size: 12px; margin-top: 5px;">'+i18n.translateFailed+"</div>",n.style.display="block",s.textContent=i18n.translate,console.error("Translation error:",e)}finally{s.disabled=!1}}document.addEventListener("DOMContentLoaded",function(){loadComments()}),(document.readyState==="interactive"||document.readyState==="complete")&&loadComments()</script><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/WangScape/ts/main.c922af694cc257bf1ecc41c0dd7b0430f9114ec280ccf67cd2c6ad55f5316c4e.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script><script>document.body.classList.add("animated-loading"),window.addEventListener("DOMContentLoaded",function(){var e=document.querySelector(".left-sidebar");e?(e.style.minHeight=window.innerHeight+"px",e.addEventListener("animationend",function(){document.body.classList.remove("animated-loading"),e.style.minHeight=""},{once:!0})):document.body.classList.remove("animated-loading")})</script></body></html>